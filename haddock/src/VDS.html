<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="">&#65279;
{-# LANGUAGE  BangPatterns, UnboxedTuples, DeriveGeneric, StrictData, Strict #-}

{- |
        Module     : VDS
        Copyright  : (c) Kaya Akagi. 2018-2019
        Maintainer : akagi15@cs.dis.titech.ac.jp
        
        
        * V&#34920;&#20316;&#34920;&#12398;&#12383;&#12417;&#12398;&#12487;&#12540;&#12479;&#22411;&#12420;&#22522;&#26412;&#30340;&#12394;&#20966;&#29702;&#29992;&#12398;&#38306;&#25968;&#12434;&#12414;&#12392;&#12417;&#12383;&#12514;&#12472;&#12517;&#12540;&#12523;
        * &#34920;&#35352;&#12434;&#32113;&#19968;&#12377;&#12427;&#12383;&#12417;&#12395;&#26085;&#26412;&#35486;&#12434;&#20351;&#12387;&#12390;&#12356;&#12427;&#12398;&#12391;&#12289;&#31561;&#24133;&#12501;&#12457;&#12531;&#12488;&#25512;&#22888;
        
        
        * &#12456;&#12531;&#12467;&#12540;&#12487;&#12451;&#12531;&#12464;&#12395;&#38306;&#12375;&#12390;
            
            &gt; &#20837;&#20986;&#21147;&#12418;&#21547;&#12417;&#12390;&#12377;&#12409;&#12390;UTF-8&#12391;&#32113;&#19968;&#12377;&#12427;
            &gt; Windows&#12391;&#12398;&#36215;&#21205;&#12399;&#24819;&#23450;&#12375;&#12390;&#12356;&#12394;&#12356;&#12398;&#65292;Docker&#12434;&#21033;&#29992;&#12375;&#12390;&#65292;Linux&#19978;&#12391;&#21205;&#12363;&#12377;&#12371;&#12392;
            &gt; Docker for Windows &#12434;&#21033;&#29992;&#12377;&#12427;&#22580;&#21512;&#12399;chcp 65001&#12434;&#12375;&#12394;&#12356;&#12392;TemplateHaskell&#37096;&#20998;&#12398;&#12467;&#12531;&#12497;&#12452;&#12523;&#12364;&#36890;&#12425;&#12394;&#12356;&#65294;
            &gt; Docker tool box &#12399;UTF-8 &#23550;&#24540;&#12391;&#27515;&#12396;&#12398;&#12391;&#20351;&#12431;&#12394;&#12356;&#65294;
        
        * Read &#12395;&#38306;&#12375;&#12390;
            
            &gt; &#12377;&#12409;&#12390;Read&#22411;&#12398;Instans &#12392;&#12394;&#12387;&#12390;&#12356;&#12427;&#12364;&#65292;read&#38306;&#25968;&#12399;&#36933;&#12377;&#12366;&#12427;&#12398;&#12391;parser&#12391;&#35501;&#12416;&#12371;&#12392;&#65294;
        
        
        * &#12467;&#12513;&#12531;&#12488;&#12395;&#38306;&#12375;&#12390;
        
            &gt; Haddock &#21069;&#25552;
--          &gt; Error &#12391;&#12479;&#12464;&#20184;&#12369;&#12375;&#12390;&#65292;&#21839;&#38988;&#28857;&#25351;&#25688;
-}

module VDS where

import qualified    Data.Vector                     as V
import qualified    Data.Vector.Mutable             as MV
import qualified    Data.Map.Strict                 as Map
import              Data.Map.Strict                 (Map)
import qualified    Data.Text                       as T
import qualified    Data.Text.Lazy                  as TL
import qualified    Data.Text.Encoding              as E
import qualified    Data.Text.IO                    as TO
import qualified    Data.Text.Lazy.IO               as TLO
import qualified    Data.List                       as L   
import qualified    Data.Maybe                      as Maybe
import              Data.ByteString                 (ByteString)
import qualified    Numeric                         as N
import              Data.Vector                     (Vector)
import              Data.Array.IArray
import              Data.Array.ST
import              Data.Array.IO
import              Data.Ix
import              Data.STRef
import              Data.IORef
import              GHC.Err
import              Control.Monad
import              Control.Monad.ST
import              Data.Either
import              Data.Char
import              System.IO
import              Control.DeepSeq
import              GHC.Generics (Generic, Generic1)
import qualified    Data.Attoparsec.Text.Lazy       as DATL
import              Data.Attoparsec.Text.Lazy
import              Control.Applicative
import              Control.Monad.IO.Class (liftIO, MonadIO)
import              Control.Monad.Trans.Resource.Internal
import              Debug.Trace

-- conduit
import              Data.Conduit 
import qualified    Data.Conduit.List               as CL
import qualified    Data.Conduit.Binary             as CB hiding (sequence, dropWhile, sourceFile)
import qualified    Data.Conduit.Combinators        as CC


--  for pararel 
import              Control.Parallel.Strategies     hiding (parMap, (.|))
import              Control.Parallel
import qualified    Control.Monad.Parallel          as CMP

--  Original Modules

import qualified    CSVAttoParserTLazy              as CSV
import              CSVAttoParserTLazy


------------------------------------------------------------
-- * General Functions
------------------------------------------------------------

-- | &#12487;&#12496;&#12483;&#12464;&#29992;&#12398;Map.lookup
lookupErr :: (Ord a, Show a) =&gt;  a -&gt; Map a b -&gt; b 
lookupErr x th = case (Map.lookup x th) of
                     Just a  -&gt; a
                     Nothing -&gt; error $ &quot;Can not transrate \&quot;&quot; ++ show x  ++ &quot;\&quot;&quot;


-- ** For Parallel 
-----------------------------------------------------------

-- | Parallel map
parMap :: (a -&gt; b) -&gt; [a] -&gt; Eval [b]
parMap f [] = return []
parMap f !(a:as)  = do
    b  &lt;- rpar (f a)
    bs &lt;- parMap f as
    return (b:bs) 

parMapStrict :: NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; Eval [b]
parMapStrict f [] = return []
parMapStrict f !(a:as)  = do
    ! b  &lt;- rpar (f a)
    ! bs &lt;- b `deepseq` parMap f as
    return  (b:bs) 


-- |  Parallel mapM_
parMapM_ f xs = sequence_ $ runEval $ parMap f xs 

parMapM f xs = sequence $ runEval $ parMap f xs

-- |  Parallel forM_ only for ST
parForMST_ ::  [a] -&gt; (a -&gt; ST s a1) -&gt; ST s ()
parForMST_ = flip parMapM_ 

parForMIO_ :: [a] -&gt; (a -&gt; IO a1) -&gt; IO ()
parForMIO_ = flip parMapM_ 


multi :: (a -&gt; a) -&gt; Int -&gt; (a -&gt; a)
multi f 1 = f
multi f n | n &lt;= 0    =  error &quot;multipled minus&quot; 
          | otherwise =  f.(multi f (n-1))


-- ** For fast Read
-----------------------------------------------------------

fastReadInt :: String -&gt; Int
fastReadInt s = case N.readDec s of 
            [(n,&quot;&quot;)] -&gt; n
            x        -&gt; error $ &quot;fastReadInt error ;&quot; ++ show x 

fastReadDouble :: String -&gt; Double
fastReadDouble s = case N.readFloat s of 
                [(n,&quot;&quot;)] -&gt; n
                x        -&gt; error $ &quot;fastReadDouble error ;&quot; ++ show x

noneOf cs           = satisfy (\c -&gt; not (elem c cs))


cell = (quotedCell &lt;|&gt; many' (noneOf &quot;,\n\r&quot;)) &gt;&gt;= (\res -&gt; return $! TL.pack res)

quotedCell  =  char  '&quot;'
            &gt;&gt; many' quotedChar &gt;&gt;= \content 
            -&gt; (char '&quot;' &lt;?&gt; &quot;quote at end of cell&quot;)
            &gt;&gt; return content

quotedChar =  noneOf &quot;\&quot;&quot;
          &lt;|&gt; try (string  (T.pack &quot;\&quot;\&quot;&quot;) &gt;&gt; return '&quot;')


-- ** Data input, output
------------------------------------------------------------------

type RowS    = Vector String
type ColS    = Vector String
type MatrixS = Vector (Vector String)

type RowT    = Vector TL.Text
type ColT    = Vector TL.Text
type MatrixT = Vector (Vector TL.Text)


transposeV :: MatrixT -&gt; MatrixT
transposeV mx = V.fromList $ runEval$ parMap (indicesV mx) $ [0..(lenLineV mx)]

lenLineV :: MatrixT -&gt; Int
lenLineV line = V.foldl1 max $ V.map V.length line

indicesV :: MatrixT -&gt; Int -&gt; RowT
indicesV xs i = V.map (\x -&gt; if (V.length x) &gt; i then x V.! i else TL.empty) xs

transpose :: [[TL.Text]] -&gt; [[TL.Text]]
transpose mx = runEval $ parMap (VDS.indices mx) $ [0..(lenLine mx)]

lenLine :: [[TL.Text]] -&gt; Int
lenLine line = L.maximum $ L.map L.length line

indices :: [[TL.Text]] -&gt; Int -&gt; [TL.Text]
indices xs i = L.map (\x -&gt; if (L.length x) &gt; i then x !! i else TL.empty) xs


toMap :: MatrixS -&gt; Either String (Map.Map String String)
toMap mx 
    | (V.length mx) /= 2 = Left &quot;MatrixS should has only 2 columns.&quot;
    | otherwise = Right $ Map.fromList $ V.toList 
                        $ V.zip (mx V.! 0) (mx V.! 1)

show' :: Maybe String -&gt; String
show' Nothing     = &quot;Nothing&quot;
show' (Just x)    = &quot;Just &quot; ++ x 

trim :: String -&gt; String
trim = f . f
    where f = reverse . dropWhile isSpace

isBlank :: String -&gt; Bool 
isBlank str  = L.and $ L.map isSpace str

-- | nub
mergenub :: (Ord a, Eq a) =&gt; [a] -&gt; Eval [a]
mergenub []     = return []
mergenub (x:[]) = return [x]
mergenub !xs    =  mergenub ys  &gt;&gt;= \ys'  
                -&gt; mergenub zs  &gt;&gt;= \zs'
                -&gt; ys' `par` zs' `pseq` return $! merge ys' zs'
    where
        (ys, zs) = halve xs
        merge :: (Ord a, Eq a) =&gt; [a] -&gt; [a] -&gt; [a]
        merge [] [] = []
        merge [] y  = y
        merge x []  = x
        merge !(x:xs) !(y:ys)
            | x &lt; y     = [x] ++ merge xs (y:ys)  
            | x == y    = [x] ++ merge xs ys
            | otherwise = [y] ++ merge (x:xs) ys 

        halve !xs = let len = (L.length xs) `div` 2
                  in (L.take len xs, L.drop len xs)


------------------------------------------------------------
-- * Cesnsus Data
------------------------------------------------------------

--  Identification Code
-- | &#35672;&#21029;&#12467;&#12540;&#12489;&#12288;&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;&#12392;&#12399;&#21029;&#12395;,&#20840;&#12390;&#12398;&#34892;&#12398;&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#12391;&#12510;&#12488;&#12522;&#12483;&#12463;&#12473;&#12434;&#20316;&#12427;
type IC = Integer 
type Cell = (Header,IC) 

-- | &#25972;&#29702;&#12373;&#12428;&#12383;&#12487;&#12540;&#12479;&#12398;&#24418;&#24907;
-- * &#12487;&#12540;&#12479;&#12486;&#12540;&#12502;&#12523;&#12398;&#24418;&#12391;,Header &#215; IC 
--
--  &#12513;&#12514;&#12522;&#12398;&#12371;&#12392;&#12434;&#32771;&#12360;&#12427;&#12392;,DB&#12398;&#26041;&#12364;&#33391;&#12356;&#12398;&#12384;&#12364;,&#21021;&#26399;&#29872;&#22659;&#12398;&#21839;&#38988;&#12391;,&#12371;&#12358;&#12394;&#12387;&#12390;&#12356;&#12427;.
--
--  &#23436;&#20840;&#12395;&#12469;&#12531;&#12463;&#12467;&#12473;&#12488;&#12394;&#12398;&#12391;,&#20462;&#27491;&#12375;&#12383;&#12411;&#12358;&#12364;&#12424;&#12356;.

-- | IMutableArray CensusData
type CensusData = Array Cell Val

-- | MutableArray&#29256;&#12398;CensusData
type STCensusData s = STArray s Cell Val
type IOCensusData = IOArray Cell Val

-- | Stream &#29992;&#12398; CensusData
type CensusRow   = Array   Header Val
type IOCensusRow = IOArray Header Val



-- | &#12486;&#12540;&#12502;&#12523;&#12363;&#12425;&#35201;&#32032;&#12434;&#25277;&#20986;&#12377;&#12427;&#38306;&#25968;
proj :: CensusData -&gt; Cell -&gt;  Val
proj d c  = d ! c 


------------------------------------------------------------------
--  ** &#22793;&#25563;&#12373;&#12428;&#12383; Census Data &#12363;&#12425;&#12398;&#35501;&#12415;&#26360;&#12365;&#20966;&#29702;
------------------------------------------------------------------
type InputFile  = FilePath
type OutputFile = FilePath


headerList = [H&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489; ..  H&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;]
outputHeader = TL.concat $ (L.intersperse (TL.pack &quot;,&quot;)) 
                         $ L.map (TL.pack . show) headerList

-- | CensusData &lt;-&gt; CSV &#12398;&#22793;&#25563;&#12434;&#23450;&#32681;&#12377;&#12427;
--
--   Header &#12434;&#25351;&#23450;&#12375;&#12390;&#25351;&#23450;&#12373;&#12428;&#12383;&#12487;&#12540;&#12479;&#12434;&#35501;&#12415;&#36796;&#12416;
readData :: Header -&gt; [Header] -&gt; [TL.Text] -&gt; Val
readData !x !hds !xs   =  let !tx = projHd x hds xs
                       in parseVal tx
                       
    where
    projHd :: Header -&gt; [Header] -&gt; [TL.Text] -&gt; TL.Text
    projHd hd hds tx =  case L.elemIndex hd hds of
                        Just x  -&gt; if (length tx - 1) &gt;= x  then (L.!!) tx x 
                                                            else error $ &quot;Can not project hd \&quot;&quot; 
                                                                    ++ (show hd)  ++ &quot;\&quot; line is too short&quot;
                                                                    ++ show tx
                        Nothing -&gt; error  $ &quot;Can not project hd \&quot;&quot; 
                                        ++ (show) hd  ++ &quot;\&quot; in \r\n&quot;  
                                        ++ show hds


-- | CensusData &lt;-&gt; CSV &#12398;&#22793;&#25563;&#12434;&#23450;&#32681;&#12377;&#12427;
--
--   &#26368;&#36969;&#21270;&#29992;&#12398;Header&#12434;Map&#12395;&#12375;&#12383;&#12496;&#12540;&#12472;&#12519;&#12531;
readDataMap :: Header -&gt; Map Header Int  -&gt; [TL.Text] -&gt; Val
readDataMap !x !hds !xs   =  let !tx = projHd x hds xs
                       in parseVal tx
          
    where
    projHd :: Header -&gt; Map Header Int -&gt; [TL.Text] -&gt; TL.Text
    projHd hd hds tx =  case Map.lookup hd hds of
                        Just x  | (length tx - 1) &gt;= x  -&gt; (L.!!) tx x
                                | otherwise             -&gt; error    $  &quot;Can not project hd \&quot;&quot; 
                                                                    ++ (show hd)  ++ &quot;\&quot; line is too short&quot;
                                                                    ++ show tx
                        Nothing -&gt; error  $ &quot;Can not project hd \&quot;&quot; 
                                        ++ (show) hd  ++ &quot;\&quot; in \r\n&quot;  
                                        ++ show hds




writeCensus :: FilePath -&gt; CensusData -&gt; IO ()
writeCensus filePath cd = do 
        let maxNum = (snd.snd) $ bounds cd

        wHandle &lt;- openFile filePath WriteMode
        TLO.hPutStrLn wHandle outputHeader 
        
        forM_ [0 .. maxNum] $ \num -&gt; do 
            let line = L.map (\x -&gt; (TL.pack . show) (cd ! (x,num) )) headerList 
            CSV.hPutCsvLn wHandle line 
        
        hClose wHandle

writeIOCensus :: FilePath -&gt; IOCensusData -&gt; IO ()
writeIOCensus filePath icd = do 
        maxNum &lt;- (snd.snd) &lt;$&gt; getBounds icd

        wHandle &lt;- openFile filePath WriteMode
        TLO.hPutStrLn wHandle outputHeader
        
        forM_ [0 .. maxNum] $ \num -&gt; do
                line &lt;- forM headerList $ \hd -&gt; 
                        readArray icd (hd, num)
                        &gt;&gt;= return . TL.pack . show 
                CSV.hPutCsvLn wHandle line
        hClose wHandle


readIOCensus :: FilePath -&gt; IO IOCensusData
readIOCensus filePath = do 
        !num     &lt;- toInteger. L.length . TL.lines &lt;$&gt; TLO.readFile filePath
        !file    &lt;- readCSVT filePath 
        !idx     &lt;- newIORef 0
        let !headers = L.map parseHeader $ L.head file
        arr     &lt;- newArray ((H&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;, 0),(H&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;, num)) Null :: IO IOCensusData
        CMP.forM_ (tail file) $ \line -&gt; do
            CMP.forM_ headers $ \h -&gt;  do
                let val = readData h headers line
                tempNum &lt;- readIORef idx
                writeArray arr (h,tempNum) val
            modifyIORef idx (+ 1)
        return arr


-- | File&#12434;&#12377;&#12409;&#12390;Array :: CensusData &#12391;&#35501;&#12415;&#36796;&#12416;
readCensus :: FilePath -&gt; IO CensusData
readCensus filePath = do 
        !num     &lt;- toInteger. L.length . TL.lines &lt;$&gt; TLO.readFile filePath
        !file    &lt;- readCSVT filePath 
        !idx     &lt;- newIORef 0
        let !headers = L.map parseHeader $ L.head file
        !arr     &lt;- newArray ((H&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;, 0),(H&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;, num)) Null :: IO IOCensusData
        CMP.forM_ (tail file) $ \line -&gt; do
            CMP.forM_ headers $ \h -&gt;  do
                let !val = readData h headers line
                !tempNum &lt;- readIORef idx
                val `deepseq` writeArray arr (h,tempNum) val
            modifyIORef idx (+ 1)
        !result &lt;- freeze arr :: IO CensusData
        return result



-- | &#12501;&#12449;&#12452;&#12523;&#12363;&#12425;&#12487;&#12540;&#12479;&#12434;&#21462;&#12387;&#12390;&#12365;&#12390;,censusRow&#12395;&#12377;&#12427;Sorce
-- 
--   &#12513;&#12514;&#12522;&#28040;&#36027;&#12399;&#20302;&#12356;&#12364;&#36880;&#27425;&#20966;&#29702;&#12375;&#12363;&#12391;&#12365;&#12394;&#12356;&#12363;&#12388;&#65292;&#36933;&#12356;
sourceCensus :: MonadResource m =&gt;  FilePath -&gt; ConduitT a IOCensusRow m ()
sourceCensus input  =  CC.sourceFile input      .| CB.lines
                                                .| CL.map (TL.fromStrict . E.decodeUtf8)
                                                .| text2IOCensusRow 0 (Map.empty)

-- | Text&#12434;&#21463;&#12369;&#21462;&#12387;&#12390;&#65292;IOCensusRow&#12395;&#22793;&#25563;&#12377;&#12427;Conduit

text2IOCensusRow :: (Monad m, MonadIO m ) =&gt; Integer -&gt; Map Header Int -&gt; ConduitT TL.Text IOCensusRow m ()
text2IOCensusRow n hd   | n == 0     = await &gt;&gt;= \ firstLine
                                      -&gt; case firstLine of 
                                            Nothing     -&gt; return ()
                                            Just line   -&gt;  let hdMap = makeHeadMap line 
                                                            in await &gt;&gt;= \sndLine
                                                            -&gt; case sndLine of 
                                                                    Nothing     -&gt; return ()
                                                                    Just line2  -&gt; liftIO (g hdMap line2) &gt;&gt;= \result
                                                                                -&gt; yield result  &gt;&gt; text2IOCensusRow (n + 1) hdMap
                
                        | otherwise =  await &gt;&gt;= \ tailLine 
                                    -&gt; case tailLine of 
                                        Nothing   -&gt; return () 
                                        Just line -&gt; liftIO (g hd line) &gt;&gt;= \ result
                                                  -&gt; yield result 
                                                  &gt;&gt; text2IOCensusRow (n + 1) hd
    where
    makeHeadMap hd = Map.fromList (L.zip (L.map parseHeader ((L.head . parseCSVTErr) hd)) [0 ..]) 

    g :: Map Header Int -&gt; TL.Text -&gt; IO IOCensusRow
    g hd line = do  arr  &lt;- newArray (H&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;, H&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;) Null :: IO IOCensusRow
                    CMP.forM_ headerList $ \h -&gt;  do
                        let val = readDataMap h hd ((L.head . parseCSVTErr) line)
                        writeArray arr h val
                    return arr


-- | IOCensusRow&#12434;&#20986;&#21147;&#12377;&#12427;Sink
--
--  Double &#12399;&#12501;&#12449;&#12452;&#12523;&#12398;&#26368;&#22823;&#34892;&#25968;,&#36914;&#25431;&#29575;&#12434;&#35336;&#31639;&#12377;&#12427;
sinkCensus :: MonadResource m =&gt; Double -&gt; FilePath -&gt; ConduitT IOCensusRow Void m ()
sinkCensus !maxRowNum !outputFile = ioCensusRow2Text maxRowNum 0    .| CL.map (E.encodeUtf8 . TL.toStrict) 
                                                                    .| CC.unlinesAscii
                                                                    .| CC.sinkFile outputFile


-- | IOCensusRow&#12434;&#21463;&#12369;&#21462;&#12387;&#12390;Text&#12395;&#12377;&#12427;Conduit

ioCensusRow2Text :: (Monad m, MonadIO m) =&gt; Double -&gt; Integer -&gt;  ConduitT IOCensusRow TL.Text m ()
ioCensusRow2Text !maxRowNum !num    | num == 0  = yield outputHeader &gt;&gt; f maxRowNum (num + 1)
                                    | otherwise = f maxRowNum num  
    where
    f !maxRowNum !num = do 
        maybeIcd &lt;- await
        case maybeIcd of 
            Nothing   -&gt; liftIO (print &quot;finished&quot;) &gt;&gt;  return () 
            Just icd  -&gt; liftIO (forM headerList (\ hd -&gt;  TL.pack &lt;$&gt; show &lt;$&gt; (readArray icd hd)))
                      &gt;&gt;= \ result
                      -&gt; yield  (( TL.concat . (L.intersperse (TL.pack &quot;,&quot;)).(L.map toCsvText)) result)
                      &gt;&gt; let !progress = &quot;   Progress : &quot; ++ show (100 * (fromIntegral num) / maxRowNum) ++ &quot; % \r&quot;
                      in when (rem num 10 == 0 ) (liftIO (putStr progress &gt;&gt; hFlush stdout ))
                      &gt;&gt; ioCensusRow2Text maxRowNum (num + 1)




-- | &#12475;&#12531;&#12469;&#12473;&#20491;&#31080;&#12398;&#35519;&#26619;&#38917;&#30446;&#65288;&#12487;&#12540;&#12479;&#12398;&#12504;&#12483;&#12480;&#12540;&#65289;
-- * &#12371;&#12428;&#12391;&#12487;&#12540;&#12479;&#12434;&#25277;&#20986;&#12377;&#12427;

data Header = H&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;              -- ^ &#22411; : VText              &#27010;&#35201;: &#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;, &#21517;&#23492;&#12379;&#12395;&#29992;&#12356;&#12427;
            | H&#20107;&#26989;&#25152;&#30058;&#21495;                  -- ^ &#22411; : VText              &#27010;&#35201;: &#20107;&#26989;&#25152;&#30058;&#21495;,&#20107;&#26989;&#25152;&#12398;&#35672;&#21029;&#12395;&#29992;&#12356;&#12427;
            | H&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;                -- ^ &#22411; :                    &#27010;&#35201;: &#35519;&#26619;&#31080;&#12398;&#31278;&#39006;              
            | H&#32207;&#22770;&#19978;                      -- ^ &#22411; : Double             &#27010;&#35201;: &#65339;&#38598;&#35336;&#29992;&#65341;&#22770;&#19978;&#65288;&#21454;&#20837;&#65289;&#37329;&#38989;
            | H&#22320;&#22495;&#12467;&#12540;&#12489;                  -- ^ &#22411; : TL.Text            &#27010;&#35201;: [&#30906;&#23450;]&#24066;&#21306;&#30010;&#26449;&#12467;&#12540;&#12489;(&#25152;&#22312;&#22320;)
            | H&#32076;&#21942;&#32068;&#32340;                    -- ^ &#22411; :                    &#27010;&#35201;: &#32076;&#21942;&#32068;&#32340;
            | H&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;              -- ^ &#22411; :                    &#27010;&#35201;: &#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;
            | H&#38599;&#29992;&#24773;&#22577;                    -- ^ &#22411; :                    &#27010;&#35201;: &#38599;&#29992;&#24773;&#22577;
            | H&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;            -- ^ &#22411; :                    &#27010;&#35201;: &#65339;&#20107;&#65341;&#21336;&#29420;&#12539;&#26412;&#25152;&#12539;&#25903;&#25152;&#65299;&#21306;&#20998;
            | H&#36027;&#29992;&#31561;&#12398;&#20869;&#35379;                -- ^ &#22411; : Cars               &#27010;&#35201;: &#36027;&#29992;&#31561;&#12398;&#20869;&#35379;
            | H&#29983;&#29987;_&#37489;&#26989;_&#25968;&#37327;              -- ^ &#22411; : Cars               &#27010;&#35201;: &#29983;&#29987;&#25968;&#37327;&#65288;&#37489;&#26989;&#65289;
            | H&#29983;&#29987;_&#37489;&#26989;_&#37329;&#38989;              -- ^ &#22411; : Cars               &#27010;&#35201;: &#29983;&#29987;&#37329;&#38989;&#65288;&#37489;&#26989;&#65289;
            | H&#29983;&#29987;_&#36786;&#26519;&#28417;&#26989;_&#37329;&#38989;          -- ^ &#22411; : Cars               &#27010;&#35201;: &#29983;&#29987;&#37329;&#38989;&#65288;&#36786;&#26519;&#27700;&#29987;&#26989;&#65289;
            | H&#21830;&#21697;&#21029;&#21368;&#22770;&#38989;                -- ^ &#22411; : Cars               &#27010;&#35201;: &#21830;&#21697;&#21368;&#22770;&#38989;
            | H&#21830;&#21697;&#21029;&#23567;&#22770;&#38989;                -- ^ &#22411; : Cars               &#27010;&#35201;: &#24180;&#38291;&#21830;&#21697;&#23567;&#22770;&#38989;
            | H&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;           -- ^ &#22411; :                    &#27010;&#35201;: &#21307;&#30274;&#31119;&#31049;&#12398;&#20107;&#26989;&#21454;&#20837;
            | H&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;         -- ^ &#22411; :                    &#27010;&#35201;: &#20107;&#26989;&#25152;&#12398;&#24418;&#24907;&#65288;&#21307;&#30274;&#31119;&#31049;&#65289; 
            | H&#20986;&#33655;&#38989;_&#35069;&#36896;&#26989;               -- ^ &#22411; : Cars               &#27010;&#35201;: &#35069;&#36896;&#21697;&#20986;&#33655;&#38989;
            | H&#22312;&#24235;&#38989;_&#35069;&#36896;&#26989;               -- ^ &#22411; : Cars               &#27010;&#35201;: &#35069;&#36896;&#21697;&#22312;&#24235;&#38989;
            | H&#21454;&#20837;&#38989;_&#21152;&#24037;&#36035;               -- ^ &#22411; : Cars               &#27010;&#35201;: &#21152;&#24037;&#36035;&#21454;&#20837;&#38989;
            | H&#21454;&#20837;&#38989;_&#35069;&#36896;&#26989;&#20197;&#22806;           -- ^ &#22411; : Cars               &#27010;&#35201;: &#35069;&#36896;&#26989;&#20197;&#22806;&#12398;&#21454;&#20837;&#37329;&#38989;
            | H&#21407;&#26448;&#26009;&#20351;&#29992;&#38989;                -- ^ &#22411; : VDouble               &#27010;&#35201;: &#21407;&#26448;&#26009;,&#29123;&#26009;,&#38651;&#21147;&#12398;&#20351;&#29992;&#38989;,&#21463;&#35351;&#29983;&#29987;&#36027;,&#35069;&#36896;&#31561;&#12395;&#38306;&#36899;&#12377;&#12427;&#22806;&#27880;&#36027; 
            | H&#21454;&#20837;&#20869;&#35379;_&#23398;&#26657;               -- ^ &#22411; : Cars               &#27010;&#35201;: &#23398;&#26657;&#31278;&#39006;&#21029;&#21454;&#20837;&#20869;&#35379;
            | H&#23398;&#26657;&#31561;&#12398;&#31278;&#39006;                -- ^ &#22411; : VText              &#27010;&#35201;: &#20107;&#26989;&#25152;&#35519;&#26619;&#31080;&#12395;&#12362;&#12369;&#12427;&#23398;&#26657;&#31958;&#12398;&#31278;&#39006;
            | H&#24180;&#21021;&#35069;&#36896;&#21697;&#22312;&#24235;&#38989;            -- ^ &#22411; : Double
            | H&#24180;&#26411;&#35069;&#36896;&#21697;&#22312;&#24235;&#38989;            -- ^ &#22411; : Double
            | H&#24180;&#21021;&#21322;&#35069;&#21697;&#21450;&#12403;&#20181;&#25499;&#21697;        -- ^ &#22411; : Double
            | H&#24180;&#26411;&#21322;&#35069;&#21697;&#21450;&#12403;&#20181;&#25499;&#21697;        -- ^ &#22411; : Double
            | H&#20107;&#26989;&#21454;&#20837;_&#12469;B                -- ^ &#22411; : Cars
            | H&#21830;&#21697;&#21029;&#12522;&#12540;&#12473;&#22865;&#32004;&#39640;          -- ^ &#22411; : Cars               &#27010;&#35201;: &#12522;&#12540;&#12473;&#24180;&#38291;&#22865;&#32004;&#39640;  
            | H&#21830;&#21697;&#21029;&#12524;&#12531;&#12479;&#12523;&#22770;&#19978;&#39640;        -- ^ &#22411; : Cars               &#27010;&#35201;: &#12524;&#12531;&#12479;&#12523;&#24180;&#38291;&#22770;&#19978;&#39640;
            | H&#12524;&#12531;&#12479;&#12523;&#32207;&#22770;&#19978;&#39640;            -- ^ &#22411; : Double             &#27010;&#35201;: &#12524;&#12531;&#12479;&#12523;&#24180;&#38291;&#32207;&#22770;&#19978;&#39640; 
            | H&#12522;&#12540;&#12473;&#24180;&#38291;&#22865;&#32004;&#39640;            -- ^ &#22411; : Double             &#27010;&#35201;: &#12522;&#12540;&#12473;&#24180;&#38291;&#32207;&#22865;&#32004;&#39640;  
            | H&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;_&#12469;B        -- ^ &#22411; : E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;  &#27010;&#35201;: &#12469;&#12540;&#12499;&#12473;&#38306;&#36899;&#29987;&#26989;B&#12398;&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;
            | H&#21516;&#26989;&#32773;&#21106;&#21512;_&#12469;B              -- ^ &#22411; : VDouble 
            | H&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;_&#21307;&#30274;&#31119;&#31049;   -- ^ &#22411; : E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;  &#27010;&#35201;: &#21307;&#30274;&#31119;&#31049;&#12398;&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;
            | H&#20462;&#29702;&#25163;&#25968;&#26009;&#21454;&#20837;_&#21830;&#26989;         -- ^ &#22411; : Cars               &#27010;&#35201;: &#21830;&#21697;&#36009;&#22770;&#12395;&#38306;&#12377;&#12427;&#12381;&#12398;&#20182;&#12398;&#21454;&#20837;&#38989; &#20869; &#20462;&#29702;&#25163;&#25968;&#26009;&#21454;&#20837;
            | H&#20210;&#31435;&#25163;&#25968;&#26009;&#21454;&#20837;_&#21830;&#26989;         -- ^ &#22411; : Double             &#27010;&#35201;: &#21830;&#21697;&#36009;&#22770;&#12395;&#38306;&#12377;&#12427;&#12381;&#12398;&#20182;&#12398;&#21454;&#20837;&#38989; &#20869; &#20210;&#31435;&#25163;&#25968;&#26009;&#21454;&#20837;
            | H&#21830;&#21697;&#22770;&#19978;&#21407;&#20385;                -- ^ &#22411; : VDouble            &#27010;&#35201;: &#21830;&#21697;&#22770;&#19978;&#21407;&#20385;
            | H&#24180;&#21021;&#21830;&#21697;&#25163;&#25345;&#38989;              -- ^ &#22411; : VDouble            &#27010;&#35201;: &#24180;&#21021;&#21830;&#21697;&#25163;&#25345;&#38989;
            | H&#24180;&#26411;&#21830;&#21697;&#25163;&#25345;&#38989;              -- ^ &#22411; : VDouble            &#27010;&#35201;: &#24180;&#26411;&#21830;&#21697;&#25163;&#25345;&#38989;
            | H&#24180;&#38291;&#20181;&#20837;&#38989;                  -- ^ &#22411; : VDouble            &#27010;&#35201;: &#24180;&#38291;&#25152;&#21697;&#20181;&#20837;&#38989;
            | H&#23550;&#35937;&#24180;&#24230;                    -- ^ &#22411; : Int                &#27010;&#35201;: &#35519;&#26619;&#24180;&#24230;
            | H&#28040;&#36027;&#31246;&#35352;&#20837;&#12398;&#21029;              -- ^ &#22411; : Bool               &#27010;&#35201;: &#28040;&#36027;&#31246;&#36796;&#35352;&#20837;&#12398;&#21029;
            | H&#20107;&#26989;&#21029;&#22770;&#19978;&#39640;                -- ^ &#22411; : Cars               &#27010;&#35201;: &#20107;&#26989;&#21029;&#22770;&#19978;&#39640;
            | H&#36664;&#20986;&#21106;&#21512;                    -- ^ &#22411; : Double             &#27010;&#35201;: &#35069;&#36896;&#21697;&#20986;&#33655;&#38989;&#31561;&#12395;&#21344;&#12417;&#12427;&#30452;&#25509;&#36664;&#20986;&#38989;&#12398;&#21106;&#21512;
            | H&#20107;&#26989;&#24418;&#24907;                    -- ^ &#22411; : BusinessStyle      &#27010;&#35201;: &#20107;&#26989;&#12398;&#24418;&#24907;
            | H&#20107;&#21069;&#26684;&#20184;_&#20107;&#26989;&#25152;             -- ^ &#22411; : E&#29987;&#26989;&#26684;&#20184;          &#27010;&#35201;: &#12487;&#12501;&#12457;&#12523;&#12488;&#12398;&#29987;&#26989;&#26684;&#20184;&#12369;
            | H&#20107;&#21069;&#26684;&#20184;_&#20225;&#26989;               -- ^ &#22411; : E&#29987;&#26989;&#26684;&#20184;          &#27010;&#35201;: &#12487;&#12501;&#12457;&#12523;&#12488;&#12398;&#29987;&#26989;&#26684;&#20184;&#12369;
            | H&#20027;&#12394;&#20107;&#26989;&#12398;&#31278;&#39006;              -- ^ &#22411; : VText              &#27010;&#35201;: &#12469;A&#20107;&#26989;&#25152;&#35519;&#26619;&#31080;&#12398;&#20107;&#26989;&#36984;&#25246;
            | H&#29987;&#26989;&#26684;&#20184;                    -- ^ &#22411; : E&#29987;&#26989;&#26684;&#20184;          
            | H&#20449;&#29992;&#20849;&#28168;&#20107;&#26989;&#12398;&#26377;&#28961;          -- ^ &#22411; : Bool               &#27010;&#35201;: &#20449;&#29992;&#12539;&#20849;&#28168;&#20107;&#26989;&#12398;&#26377;&#28961; 
            | H&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;              -- ^ &#22411; :                    &#27010;&#35201;:            
            | H&#22243;&#20307;&#12398;&#31278;&#39006;                  -- ^ &#22411; : E&#22243;&#20307;&#12398;&#31278;&#39006;
            | H8&#26178;&#38291;&#25563;&#31639;&#38599;&#29992;&#32773;&#25968;_&#12469;B       -- ^ &#22411; : Double      
            | H8&#26178;&#38291;&#25563;&#31639;&#38599;&#29992;&#32773;&#25968;_&#21830;&#26989;      -- ^ &#22411; : Double
            | H&#22770;&#22580;&#38754;&#31309;                    -- ^ &#22411; : Double
            | H&#12475;&#12523;&#12501;&#12469;&#12540;&#12499;&#12473;              -- ^ &#22411; : Bool 
            | H&#38283;&#24215;&#38281;&#24215;&#26399;&#38291;                -- ^ &#22411; : Int 
            | H&#36009;&#22770;&#24418;&#24907;                    -- ^ &#22411; : E&#36009;&#22770;&#24418;&#24907;
            | H&#21830;&#21697;&#24418;&#24907;                    -- ^ &#22411; : E&#21830;&#21697;&#24418;&#24907;
            | H&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;               -- ^ &#22411; : E&#24215;&#33303;&#24418;&#24907;
            | H&#24215;&#33303;&#24418;&#24907;_&#12469;B                -- ^ &#22411; : VText
            | H&#20107;&#26989;&#21454;&#20837;_&#24314;&#12469;A              -- ^ &#22411; : Cars               &#27010;&#35201;: &#20107;&#26989;&#21454;&#20837;1&#12540;10&#20301;
            | H&#24037;&#20107;&#31278;&#39006;                    -- ^ &#22411; : E&#24037;&#20107;&#31278;&#39006;          &#27010;&#35201;: &#26989;&#24907;&#21029;&#24037;&#20107;&#31278;&#39006;
            | H&#37329;&#34701;&#26989;&#20445;&#38522;&#26989;&#12398;&#20107;&#26989;&#31278;&#39006;      -- ^ &#22411; : VInt               &#27010;&#35201;: 1 - 19 &#12398;Int
            | H&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;      -- ^ &#22411; : Cars               &#27010;&#35201;: 
            | H&#24180;&#21021;&#21407;&#26448;&#26009;&#21450;&#12403;&#29123;&#26009;          -- ^ &#22411; : Double             &#20351;&#29992;&#12375;&#12394;&#12356;
            | H&#24180;&#26411;&#21407;&#26448;&#26009;&#21450;&#12403;&#29123;&#26009;          -- ^ &#22411; : Double             &#20351;&#29992;&#12375;&#12394;&#12356;
            | H&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;          -- ^ &#22411; :                    &#20351;&#29992;&#12375;&#12394;&#12356; &#27010;&#35201;: &#24180;&#38291;&#21830;&#21697;&#36009;&#22770;&#38989;&#12364;&#22810;&#12356;&#37096;&#38272;
            deriving (Eq, Enum, Ord, Ix, Show, Read)

parserHeader  =  f H&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;
             &lt;|&gt; f H&#20107;&#26989;&#25152;&#30058;&#21495;               
             &lt;|&gt; f H&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;             
             &lt;|&gt; f H&#32207;&#22770;&#19978;                   
             &lt;|&gt; f H&#22320;&#22495;&#12467;&#12540;&#12489;               
             &lt;|&gt; f H&#32076;&#21942;&#32068;&#32340;                 
             &lt;|&gt; f H&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;           
             &lt;|&gt; f H&#38599;&#29992;&#24773;&#22577;                 
             &lt;|&gt; f H&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;         
             &lt;|&gt; f H&#36027;&#29992;&#31561;&#12398;&#20869;&#35379;             
             &lt;|&gt; f H&#29983;&#29987;_&#37489;&#26989;_&#25968;&#37327;           
             &lt;|&gt; f H&#29983;&#29987;_&#37489;&#26989;_&#37329;&#38989;           
             &lt;|&gt; f H&#29983;&#29987;_&#36786;&#26519;&#28417;&#26989;_&#37329;&#38989;       
             &lt;|&gt; f H&#21830;&#21697;&#21029;&#21368;&#22770;&#38989;                   
             &lt;|&gt; f H&#21830;&#21697;&#21029;&#23567;&#22770;&#38989;                   
             &lt;|&gt; f H&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;        
             &lt;|&gt; f H&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;      
             &lt;|&gt; f H&#20986;&#33655;&#38989;_&#35069;&#36896;&#26989;            
             &lt;|&gt; f H&#22312;&#24235;&#38989;_&#35069;&#36896;&#26989;            
             &lt;|&gt; f H&#21454;&#20837;&#38989;_&#21152;&#24037;&#36035;            
             &lt;|&gt; f H&#21454;&#20837;&#38989;_&#35069;&#36896;&#26989;&#20197;&#22806;        
             &lt;|&gt; f H&#21407;&#26448;&#26009;&#20351;&#29992;&#38989;
             &lt;|&gt; f H&#21454;&#20837;&#20869;&#35379;_&#23398;&#26657;
             &lt;|&gt; f H&#23398;&#26657;&#31561;&#12398;&#31278;&#39006;            
             &lt;|&gt; f H&#24180;&#21021;&#35069;&#36896;&#21697;&#22312;&#24235;&#38989;         
             &lt;|&gt; f H&#24180;&#26411;&#35069;&#36896;&#21697;&#22312;&#24235;&#38989;         
             &lt;|&gt; f H&#24180;&#21021;&#21322;&#35069;&#21697;&#21450;&#12403;&#20181;&#25499;&#21697;     
             &lt;|&gt; f H&#24180;&#26411;&#21322;&#35069;&#21697;&#21450;&#12403;&#20181;&#25499;&#21697;
             &lt;|&gt; f H&#20107;&#26989;&#21454;&#20837;_&#12469;B    
             &lt;|&gt; f H&#21830;&#21697;&#21029;&#12522;&#12540;&#12473;&#22865;&#32004;&#39640;       
             &lt;|&gt; f H&#21830;&#21697;&#21029;&#12524;&#12531;&#12479;&#12523;&#22770;&#19978;&#39640;     
             &lt;|&gt; f H&#12524;&#12531;&#12479;&#12523;&#32207;&#22770;&#19978;&#39640;         
             &lt;|&gt; f H&#12522;&#12540;&#12473;&#24180;&#38291;&#22865;&#32004;&#39640;         
             &lt;|&gt; f H&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;_&#12469;B 
             &lt;|&gt; f H&#21516;&#26989;&#32773;&#21106;&#21512;_&#12469;B     
             &lt;|&gt; f H&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;_&#21307;&#30274;&#31119;&#31049;
             &lt;|&gt; f H&#20462;&#29702;&#25163;&#25968;&#26009;&#21454;&#20837;_&#21830;&#26989;      
             &lt;|&gt; f H&#20210;&#31435;&#25163;&#25968;&#26009;&#21454;&#20837;_&#21830;&#26989;           
             &lt;|&gt; f H&#21830;&#21697;&#22770;&#19978;&#21407;&#20385;             
             &lt;|&gt; f H&#24180;&#21021;&#21830;&#21697;&#25163;&#25345;&#38989;           
             &lt;|&gt; f H&#24180;&#26411;&#21830;&#21697;&#25163;&#25345;&#38989;           
             &lt;|&gt; f H&#24180;&#38291;&#20181;&#20837;&#38989;               
             &lt;|&gt; f H&#23550;&#35937;&#24180;&#24230;                 
             &lt;|&gt; f H&#28040;&#36027;&#31246;&#35352;&#20837;&#12398;&#21029;           
             &lt;|&gt; f H&#20107;&#26989;&#21029;&#22770;&#19978;&#39640;             
             &lt;|&gt; f H&#36664;&#20986;&#21106;&#21512;                 
             &lt;|&gt; f H&#20107;&#26989;&#24418;&#24907;                 
             &lt;|&gt; f H&#20107;&#21069;&#26684;&#20184;_&#20107;&#26989;&#25152;          
             &lt;|&gt; f H&#20107;&#21069;&#26684;&#20184;_&#20225;&#26989;            
             &lt;|&gt; f H&#20027;&#12394;&#20107;&#26989;&#12398;&#31278;&#39006;            
             &lt;|&gt; f H&#29987;&#26989;&#26684;&#20184;                 
             &lt;|&gt; f H&#20449;&#29992;&#20849;&#28168;&#20107;&#26989;&#12398;&#26377;&#28961;       
             &lt;|&gt; f H&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;           
             &lt;|&gt; f H&#22243;&#20307;&#12398;&#31278;&#39006;               
             &lt;|&gt; f H8&#26178;&#38291;&#25563;&#31639;&#38599;&#29992;&#32773;&#25968;_&#12469;B    
             &lt;|&gt; f H8&#26178;&#38291;&#25563;&#31639;&#38599;&#29992;&#32773;&#25968;_&#21830;&#26989;   
             &lt;|&gt; f H&#22770;&#22580;&#38754;&#31309;                 
             &lt;|&gt; f H&#12475;&#12523;&#12501;&#12469;&#12540;&#12499;&#12473;           
             &lt;|&gt; f H&#38283;&#24215;&#38281;&#24215;&#26399;&#38291;             
             &lt;|&gt; f H&#36009;&#22770;&#24418;&#24907;                 
             &lt;|&gt; f H&#21830;&#21697;&#24418;&#24907;                 
             &lt;|&gt; f H&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;
             &lt;|&gt; f H&#24215;&#33303;&#24418;&#24907;_&#12469;B
             &lt;|&gt; f H&#20107;&#26989;&#21454;&#20837;_&#24314;&#12469;A
             &lt;|&gt; f H&#24037;&#20107;&#31278;&#39006;
             &lt;|&gt; f H&#37329;&#34701;&#26989;&#20445;&#38522;&#26989;&#12398;&#20107;&#26989;&#31278;&#39006;
             &lt;|&gt; f H&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;   
             &lt;|&gt; f H&#24180;&#21021;&#21407;&#26448;&#26009;&#21450;&#12403;&#29123;&#26009;       
             &lt;|&gt; f H&#24180;&#26411;&#21407;&#26448;&#26009;&#21450;&#12403;&#29123;&#26009;       
             &lt;|&gt; f H&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;       
            where f s = try( string (T.pack (show s))) &gt;&gt; return s

-- | Read &#12364;&#36933;&#12377;&#12366;&#12427;&#12398;&#12391;Header&#12398;&#35501;&#12415;&#36796;&#12415;&#12399;&#12371;&#12385;&#12425;&#12398;&#12497;&#12540;&#12469;&#12540;&#12434;&#29992;&#12356;&#12427;&#65294;
parseHeader :: TL.Text -&gt; Header
parseHeader tx = case parse parserHeader tx of 
        Done a r        -&gt; r
        Fail a xs err   -&gt; error $ &quot;Can not parse Header :&quot; ++ show err 
                                                         ++ show xs 
                                                         ++ show a 

-- | &#22793;&#25563;&#12373;&#12428;&#12427;&#20516;&#12399;&#20840;&#12390;Val&#22411;&#12395;&#32113;&#19968;
-- * E&#22411;&#12398;&#12487;&#12540;&#12479;&#22411;&#12434;V&#22411;&#12391;&#12521;&#12483;&#12503;
-- * &#12450;&#12531;&#12480;&#12540;&#12496;&#12540;&#12391;&#25277;&#20986;

data Val   
    = Null
    | VInt                   { int                           ::  Int                   }
    | VDouble                { double                        ::  Double                }
    | VText                  { text                          ::  TL.Text               }
    | VBool                  { bool                          ::  Bool                  }
    | VCars                  { cars                          ::  Cars                  }    
    | V&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;          { _&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;                 ::  E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;         }
    | V&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;        { _&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;               ::  E&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;       }
    | V&#38599;&#29992;&#24773;&#22577;              { _&#38599;&#29992;&#24773;&#22577;                     ::  E&#38599;&#29992;&#24773;&#22577;             }
    | V&#29987;&#26989;&#26684;&#20184;              { _&#29987;&#26989;&#26684;&#20184;                     ::  E&#29987;&#26989;&#26684;&#20184;             }
    | V&#20107;&#26989;&#24418;&#24907;              { _&#20107;&#26989;&#24418;&#24907;                     ::  E&#20107;&#26989;&#24418;&#24907;             }
    | V&#32076;&#21942;&#32068;&#32340;              { _&#32076;&#21942;&#32068;&#32340;                     ::  E&#32076;&#21942;&#32068;&#32340;             }
    | V&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;      { _&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;             ::  E&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;     }
    | V&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;    { _&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;           ::  E&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;   }
    | V&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;   { _&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;          ::  E&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;  }
    | V&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;     { _&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;            ::  E&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;    }
    | V&#22243;&#20307;&#12398;&#31278;&#39006;            { _&#22243;&#20307;&#12398;&#31278;&#39006;                   ::  E&#22243;&#20307;&#12398;&#31278;&#39006;           }
    | V&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;        { _&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;               ::  E&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;       }
    | V&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;      { _&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;             ::  E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;     }
    | V&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;         { _&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;                ::  E&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;        }
    | V&#36009;&#22770;&#24418;&#24907;              { _&#36009;&#22770;&#24418;&#24907;                     ::  E&#36009;&#22770;&#24418;&#24907;             }
    | V&#21830;&#21697;&#24418;&#24907;              { _&#21830;&#21697;&#24418;&#24907;                     ::  E&#21830;&#21697;&#24418;&#24907;             }
    | V&#24037;&#20107;&#31278;&#39006;              { _&#24037;&#20107;&#31278;&#39006;                     ::  E&#24037;&#20107;&#31278;&#39006;             }
    deriving (Show, Read, Eq, Generic)

instance NFData Val

parserNull :: Parser Val
parserNull    =  string (T.pack &quot;Null&quot;) &gt;&gt; return Null

parserVInt :: Parser ValInt
parserVInt    =  string (T.pack &quot;VInt {int = &quot;)
             &gt;&gt; DATL.double &gt;&gt;= \fl  
             -&gt; char '}' 
             &gt;&gt; return (VInt (truncate fl))

parserVDouble :: Parser ValDouble
parserVDouble = string (T.pack &quot;VDouble {double = &quot;)
             &gt;&gt; DATL.double &gt;&gt;= \fl
             -&gt; char '}'
             &gt;&gt; return (VDouble fl) 

parserVText :: Parser ValText
parserVText  =  string (T.pack &quot;VText {text = &quot;)
             &gt;&gt; quotedCell &gt;&gt;= \tx 
             -&gt; char '}'
             &gt;&gt; return  (VText (TL.pack tx))

parserVBool :: Parser ValBool
parserVBool   = string (T.pack &quot;VBool {bool = &quot;)
             &gt;&gt; (try (string (T.pack &quot;True&quot;)  &gt;&gt; return (VBool True )) 
                &lt;|&gt; (string (T.pack &quot;False&quot;) &gt;&gt; return (VBool False))) &gt;&gt;= \bl
             -&gt; char '}'
             &gt;&gt; return bl  


parserVCars :: Parser ValCars
parserVCars   =  string (T.pack &quot;VCars {cars = [&quot;)
             &gt;&gt; try (sepBy parseCar (char ',') &gt;&gt;= \cs -&gt; return cs) &gt;&gt;= \ xs  
             -&gt; string (T.pack &quot;]}&quot;)
             &gt;&gt; return (VCars (V.fromList xs))   

-- | Val &#12398;&#12467;&#12531;&#12473;&#12488;&#12521;&#12463;&#12479;&#12372;&#12392;&#12398;&#12497;&#12540;&#12469;&#12540;&#12434;&#25351;&#23450;&#12375;&#12390;&#12497;&#12540;&#12473;&#12377;&#12427;
parserVJap :: String -&gt; Parser a -&gt; (a -&gt; Val) -&gt; Parser Val
parserVJap str p vf =   string (T.pack (&quot;V&quot; ++ str ++ &quot; {_&quot; ++ str ++ &quot; = &quot;))
                    &gt;&gt;  p &gt;&gt;= \v -&gt;  char '}' &gt;&gt; return (vf v) 

parserV&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;        = parserVJap &quot;&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;&quot;          parserE&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;        V&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;
parserV&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;      = parserVJap &quot;&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;&quot;        parserE&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;      V&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;
parserV&#38599;&#29992;&#24773;&#22577;            = parserVJap &quot;&#38599;&#29992;&#24773;&#22577;&quot;              parserE&#38599;&#29992;&#24773;&#22577;            V&#38599;&#29992;&#24773;&#22577;
parserV&#29987;&#26989;&#26684;&#20184;            = parserVJap &quot;&#29987;&#26989;&#26684;&#20184;&quot;              parserE&#29987;&#26989;&#26684;&#20184;            V&#29987;&#26989;&#26684;&#20184;
parserV&#20107;&#26989;&#24418;&#24907;            = parserVJap &quot;&#20107;&#26989;&#24418;&#24907;&quot;              parserE&#20107;&#26989;&#24418;&#24907;            V&#20107;&#26989;&#24418;&#24907;
parserV&#32076;&#21942;&#32068;&#32340;            = parserVJap &quot;&#32076;&#21942;&#32068;&#32340;&quot;              parserE&#32076;&#21942;&#32068;&#32340;            V&#32076;&#21942;&#32068;&#32340;
parserV&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;    = parserVJap &quot;&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;&quot;      parserE&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;    V&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;
parserV&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;  = parserVJap &quot;&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;&quot;    parserE&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;  V&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;
parserV&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049; = parserVJap &quot;&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;&quot;   parserE&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049; V&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;
parserV&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;   = parserVJap &quot;&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;&quot;     parserE&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;   V&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;
parserV&#22243;&#20307;&#12398;&#31278;&#39006;          = parserVJap &quot;&#22243;&#20307;&#12398;&#31278;&#39006;&quot;            parserE&#22243;&#20307;&#12398;&#31278;&#39006;          V&#22243;&#20307;&#12398;&#31278;&#39006;
parserV&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;      = parserVJap &quot;&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;&quot;        parserE&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;      V&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;
parserV&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;    = parserVJap &quot;&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;&quot;      parserE&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;    V&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;
parserV&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;       = parserVJap &quot;&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;&quot;         parserE&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;       V&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;
parserV&#36009;&#22770;&#24418;&#24907;            = parserVJap &quot;&#36009;&#22770;&#24418;&#24907;&quot;              parserE&#36009;&#22770;&#24418;&#24907;            V&#36009;&#22770;&#24418;&#24907;
parserV&#21830;&#21697;&#24418;&#24907;            = parserVJap &quot;&#21830;&#21697;&#24418;&#24907;&quot;              parserE&#21830;&#21697;&#24418;&#24907;            V&#21830;&#21697;&#24418;&#24907;
parserV&#24037;&#20107;&#31278;&#39006;            = parserVJap &quot;&#24037;&#20107;&#31278;&#39006;&quot;              parserE&#24037;&#20107;&#31278;&#39006;            V&#24037;&#20107;&#31278;&#39006;

-- | Read &#12364;&#36933;&#12377;&#12366;&#12427;&#12398;&#12391;Val&#12398;&#35501;&#12415;&#36796;&#12415;&#12399;&#12371;&#12385;&#12425;&#12398;&#12497;&#12540;&#12469;&#12540;&#12434;&#29992;&#12356;&#12427;&#65294;
parserVal    =  try parserNull                
            &lt;|&gt; try parserVInt                
            &lt;|&gt; try parserVDouble             
            &lt;|&gt; try parserVText               
            &lt;|&gt; try parserVBool               
            &lt;|&gt; try parserVCars               
            &lt;|&gt; try parserV&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;       
            &lt;|&gt; try parserV&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;     
            &lt;|&gt; try parserV&#38599;&#29992;&#24773;&#22577;           
            &lt;|&gt; try parserV&#29987;&#26989;&#26684;&#20184;           
            &lt;|&gt; try parserV&#20107;&#26989;&#24418;&#24907;           
            &lt;|&gt; try parserV&#32076;&#21942;&#32068;&#32340;           
            &lt;|&gt; try parserV&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;   
            &lt;|&gt; try parserV&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272; 
            &lt;|&gt; try parserV&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;
            &lt;|&gt; try parserV&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;  
            &lt;|&gt; try parserV&#22243;&#20307;&#12398;&#31278;&#39006;         
            &lt;|&gt; try parserV&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;     
            &lt;|&gt; try parserV&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;   
            &lt;|&gt; try parserV&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;           
            &lt;|&gt; try parserV&#36009;&#22770;&#24418;&#24907;           
            &lt;|&gt; try parserV&#21830;&#21697;&#24418;&#24907;
            &lt;|&gt; try parserV&#24037;&#20107;&#31278;&#39006;             

-- | Read &#12364;&#36933;&#12377;&#12366;&#12427;&#12398;&#12391;Val&#12398;&#35501;&#12415;&#36796;&#12415;&#12399;&#12371;&#12385;&#12425;&#12398;&#12497;&#12540;&#12469;&#12540;&#12434;&#29992;&#12356;&#12427;&#65294;
parseVal :: TL.Text -&gt; Val
parseVal tx = case parse parserVal tx of 
        Done a r        -&gt; r
        Fail a xs err   -&gt; error $ &quot;Can not parse Val :&quot; ++ show a
                                                         ++ show xs 
                                                         ++ show err 

-- Val&#12384;&#12369;&#12384;&#12392;&#12431;&#12363;&#12426;&#12395;&#12367;&#12356;&#12398;&#12391;,&#12479;&#12452;&#12503;&#12471;&#12494;&#12491;&#12512;&#12434;&#20316;&#12427;

type ValInt                       = Val 
type Val&#38283;&#24215;&#38281;&#24215;&#26399;&#38291;              = Val
------------------------------------------------------------------
type ValDouble                    = Val
type Val&#12522;&#12540;&#12473;&#24180;&#38291;&#22865;&#32004;&#39640;          = Val
type Val&#12524;&#12531;&#12479;&#12523;&#32207;&#22770;&#19978;&#39640;          = Val
type Val&#21407;&#26448;&#26009;&#20351;&#29992;&#38989;              = Val
type Val&#22770;&#22580;&#38754;&#31309;                  = Val
type Val&#20462;&#29702;&#25163;&#25968;&#26009;&#21454;&#20837;_&#21830;&#26989;       = Val
type Val&#20210;&#31435;&#25163;&#25968;&#26009;&#21454;&#20837;_&#21830;&#26989;       = Val
type Val&#36664;&#20986;&#21106;&#21512;                  = Val
type Val&#21516;&#26989;&#32773;&#21106;&#21512;_&#12469;B            = Val
------------------------------------------------------------------
type ValText                      = Val
type Val&#23398;&#26657;&#31561;&#12398;&#31278;&#39006;              = Val 
type Val&#37329;&#34701;&#26989;&#20445;&#38522;&#26989;&#12398;&#20107;&#26989;&#31278;&#39006;    = Val   
type Val&#20027;&#12394;&#20107;&#26989;&#12398;&#31278;&#39006;            = Val     
type Val&#24215;&#33303;&#24418;&#24907;_&#12469;B              = Val
type Val&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;            = Val
type Val&#22320;&#22495;&#12467;&#12540;&#12489;                = Val
------------------------------------------------------------------
type ValBool                      = Val
type Val&#20449;&#29992;&#20849;&#28168;&#20107;&#26989;&#12398;&#26377;&#28961;        = Val
type Val&#12475;&#12523;&#12501;&#12469;&#12540;&#12499;&#12473;            = Val
------------------------------------------------------------------
type ValCars                      = Val
type Val&#20107;&#26989;&#21029;&#22770;&#19978;&#39640;              = Val    
type Val&#20107;&#26989;&#25152;&#21029;&#29983;&#29987;&#29289;&#21029;&#22770;&#19978;&#39640;    = Val    
type Val&#21454;&#20837;&#20869;&#35379;_&#23398;&#26657;             = Val
type Val&#36027;&#29992;&#31561;&#12398;&#20869;&#35379;              = Val
------------------------------------------------------------------
type Val&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;              = Val    
type Val&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;            = Val    
type Val&#38599;&#29992;&#24773;&#22577;                  = Val       
type Val&#20107;&#26989;&#24418;&#24907;                  = Val    
type Val&#32076;&#21942;&#32068;&#32340;                  = Val    
type Val&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;          = Val    
type Val&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;        = Val    
type Val&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;       = Val    
type Val&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;         = Val    
type Val&#21454;&#20837;&#38989;_&#35069;&#36896;&#26989;&#20197;&#22806;         = Val    
type Val&#22243;&#20307;&#12398;&#31278;&#39006;                = Val    
type Val&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;            = Val
type Val&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;             = Val 
type Val&#36009;&#22770;&#24418;&#24907;                  = Val 
type Val&#21830;&#21697;&#24418;&#24907;                  = Val 
type Val&#24037;&#20107;&#31278;&#39006;                  = Val
type Val&#20107;&#26989;&#21454;&#20837;_&#24314;&#12469;A            = Val
type Val&#20107;&#26989;&#21454;&#20837;_&#12469;B              = Val
type Val&#21830;&#21697;&#21029;&#12524;&#12531;&#12479;&#12523;&#22770;&#19978;&#39640;      = Val
type Val&#21830;&#21697;&#21029;&#12522;&#12540;&#12473;&#22865;&#32004;&#39640;        = Val
type Val&#21454;&#20837;&#38989;_&#21152;&#24037;&#36035;             = Val
type Val&#20986;&#33655;&#38989;_&#35069;&#36896;&#26989;             = Val
type Val&#21830;&#21697;&#21029;&#21368;&#22770;&#38989;              = Val
type Val&#21830;&#21697;&#21029;&#23567;&#22770;&#38989;              = Val
type Val&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;          = Val
type Val&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;_&#12469;B      = Val
type Val&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;_&#21307;&#30274;&#31119;&#31049; = Val  
------------------------------------------------------------------
type Val&#29987;&#26989;&#26684;&#20184;                  = Val
type Val&#20107;&#21069;&#26684;&#20184;_&#20225;&#26989;             = Val
type Val&#20107;&#21069;&#26684;&#20184;_&#20107;&#26989;&#25152;           = Val






-- * &#12487;&#12540;&#12479;&#22411;&#12398;&#35373;&#35336;
-----------------------------------------------------------
-- ** &#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;
-----------------------------------------------------------
{- | 
     &#32076;&#28168;&#12475;&#12531;&#12469;&#12473;&#12398;&#35519;&#26619;&#31080;&#12395;&#12399;&#65292;&#24179;&#25104;24&#65292;28&#24180;&#20849;&#12395;&#65292;&#12300;&#24066;&#21306;&#30010;&#26449;&#12467;&#12540;&#12489;&#65292;&#35519;&#26619;&#21306;&#30058;&#21495;&#65292;&#20107;&#26989;&#25152;&#30058;&#21495;&#65292;&#65290;&#12467;&#12540;&#12489;&#12301;&#12364;&#35352;&#36617;&#12373;&#12428;&#12390;&#12362;&#12426;&#65292;
     &#21516;&#19968;&#20225;&#26989;&#12395;&#23646;&#12377;&#12427;&#25903;&#25152;&#31561;&#12399;&#20840;&#12390;&#21516;&#19968;&#12398;&#12467;&#12540;&#12489;&#12434;&#25345;&#12388;&#65294;

     &#12371;&#12398;&#20107;&#26989;&#25152;&#12467;&#12540;&#12489;&#12392;&#12399;&#21029;&#12395;&#65292;&#20225;&#26989;&#20869;&#12395;&#12362;&#12356;&#12390;&#36899;&#30058;&#12373;&#12428;&#12427;2&#26689;&#12398;&#25972;&#29702;&#30058;&#21495;&#12364;&#23384;&#22312;&#12375;&#65292;
     &#12371;&#12428;&#12425;&#12398;&#12467;&#12540;&#12489;&#12434;&#20840;&#12390;&#20341;&#12379;&#12390;&#12300;&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;&#12301;&#12392;&#21628;&#12406;&#65294;
     &#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489;&#12399;&#20840;&#20107;&#26989;&#25152;&#12395;&#12381;&#12428;&#12382;&#12428;&#22266;&#26377;&#12391;&#12354;&#12426;&#65292;&#19988;&#12388;&#65292;&#21508;&#20107;&#26989;&#25152;&#12364;&#12393;&#12398;&#20225;&#26989;&#12395;&#23646;&#12377;&#12427;&#12398;&#12363;&#12434;&#21028;&#21029;&#12377;&#12427;&#12371;&#12392;&#12434;&#21487;&#33021;&#12395;&#12377;&#12427;&#65294;
-}

type E&#30452;&#36676;&#20225;&#26989;&#12467;&#12540;&#12489; = TL.Text


------------------------------------------------------------------
-- ** &#38599;&#29992;&#24773;&#22577;
------------------------------------------------------------------

data E&#38599;&#29992;&#24773;&#22577;      = E&#38599;&#29992;&#24773;&#22577; 
                    { _&#20225;&#38599;&#29992;&#32773;&#25968;                      :: !Int 
                    , _&#20225;&#20491;&#20154;&#20107;&#26989;&#20027;                    :: !Int
                    , _&#20225;&#20107;&#26989;&#24467;&#26989;&#32773;&#25968;                  :: !Int
                    , _&#20107;&#38599;&#29992;&#32773;&#25968;                      :: !Int 
                    , _&#20107;&#20491;&#20154;&#20107;&#26989;&#20027;                    :: !Int
                    , _&#20107;&#20107;&#26989;&#24467;&#26989;&#32773;&#25968;                  :: !Int } 
                    deriving (Eq, Show,Read, Generic)
instance NFData E&#38599;&#29992;&#24773;&#22577;

parserE&#38599;&#29992;&#24773;&#22577; =  do 
                string (T.pack &quot;E&#38599;&#29992;&#24773;&#22577; {&quot;)
                d1 &lt;- f &quot;_&#20225;&#38599;&#29992;&#32773;&#25968; = &quot;
                d2 &lt;- f &quot;_&#20225;&#20491;&#20154;&#20107;&#26989;&#20027; = &quot;
                d3 &lt;- f &quot;_&#20225;&#20107;&#26989;&#24467;&#26989;&#32773;&#25968; = &quot;
                d4 &lt;- f &quot;_&#20107;&#38599;&#29992;&#32773;&#25968; = &quot;
                d5 &lt;- f &quot;_&#20107;&#20491;&#20154;&#20107;&#26989;&#20027; = &quot;
                d6 &lt;- f &quot;_&#20107;&#20107;&#26989;&#24467;&#26989;&#32773;&#25968; = &quot;
                return (E&#38599;&#29992;&#24773;&#22577; d1 d2 d3 d4 d5 d6)

            where
            f :: String -&gt; Parser Int
            f s =   do 
                    string (T.pack s)
                    di &lt;-  many digit 
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return (fastReadInt di) 


------------------------------------------------------------------
-- ** &#20107;&#26989;&#12398;&#26989;&#24907; &#20491;&#20154;&#32076;&#21942;&#35519;&#26619;&#31080;&#12398;&#12415;&#65288;&#65311;&#65289;
------------------------------------------------------------------

data E&#20107;&#26989;&#24418;&#24907;  = E&#35069;&#36896;&#21368;&#22770;       -- ^ &#20027;&#12395;&#35069;&#36896;&#12375;&#12390;&#20986;&#33655;&#21448;&#12399;&#21368;&#22770;
                | E&#35069;&#36896;&#36960;&#38548;&#23567;&#22770;   -- ^ &#20027;&#12395;&#35069;&#36896;&#12375;&#12390;&#36890;&#20449;&#36009;&#22770;&#12539;&#12493;&#12483;&#12488;&#36009;&#22770;&#31561;&#12391;&#23567;&#22770;
                | E&#21152;&#24037;           -- ^ &#20027;&#12395;&#20182;&#12398;&#26989;&#32773;&#12363;&#12425;&#25903;&#32102;&#12373;&#12428;&#12383;&#21407;&#26448;&#26009;&#12395;&#12424;&#12426;&#35069;&#36896;&#12539;&#21152;&#24037;
                | E&#33258;&#20225;&#26989;&#21368;&#22770;     -- ^ &#20027;&#12395;&#21516;&#19968;&#20225;&#26989;&#12398;&#20182;&#12398;&#20107;&#26989;&#25152;&#12391;&#35069;&#36896;&#12539;&#21152;&#24037;&#12375;&#12383;&#29289;&#21697;&#12434;&#21368;&#22770;
                | E&#20182;&#20225;&#26989;&#21368;&#22770;     -- ^ &#20027;&#12395;&#20182;&#20225;&#26989;&#12398;&#20107;&#26989;&#25152;&#65288;&#19979;&#35531;&#20808;&#12418;&#21547;&#12416;&#65289;&#12391;&#29983;&#29987;&#12539;&#21152;&#24037;&#12375;&#12383;&#29289;&#21697;&#12434;&#21368;&#22770;
                | E&#35069;&#36896;&#23567;&#22770;       -- ^ &#20027;&#12395;&#35069;&#36896;&#12375;&#12390;&#12381;&#12398;&#22580;&#25152;&#12391;&#23567;&#22770;
                | E&#24215;&#38957;&#23567;&#22770;       -- ^ &#20027;&#12395;&#20182;&#12398;&#20107;&#26989;&#25152;&#12363;&#12425;&#20181;&#20837;&#12428;&#12383;&#21830;&#21697;&#12434;&#24215;&#33303;&#12391;&#23567;&#22770;
                | E&#36960;&#38548;&#23567;&#22770;       -- ^ &#20027;&#12395;&#20181;&#20837;&#12428;&#12383;&#21830;&#21697;&#12434;&#24215;&#33303;&#12434;&#25345;&#12383;&#12378;&#12395;&#36890;&#20449;&#36009;&#22770;&#12539;&#12493;&#12483;&#12488;&#36009;&#22770;&#12539;&#35370;&#21839;&#36009;&#22770;&#31561;&#12391;&#23567;&#22770;
                | E&#39135;&#21697;&#23567;&#22770;       -- ^ &#20027;&#12395;&#35519;&#29702;&#28168;&#12415;&#12398;&#26009;&#29702;&#21697;&#12434;&#23567;&#22770;
                | E&#26009;&#29702;&#37197;&#36948;       -- ^ &#20027;&#12395;&#39015;&#23458;&#12398;&#27880;&#25991;&#12391;&#35519;&#29702;&#12377;&#12427;&#26009;&#29702;&#21697;&#12434;&#25552;&#20379;&#65288;&#37197;&#36948;&#12434;&#21547;&#12416;&#65289;
                | E&#22303;&#26408;           -- ^ &#22303;&#26408;&#24037;&#20107;&#12398;&#26045;&#24037;&#38989;&#12364;&#12289;&#26045;&#24037;&#38989;&#20840;&#20307;&#12398;80&#65285;&#20197;&#19978;
                | E&#24314;&#31689;           -- ^ &#24314;&#31689;&#24037;&#20107;&#12398;&#26045;&#24037;&#38989;&#12364;&#12289;&#26045;&#24037;&#38989;&#20840;&#20307;&#12398;80&#65285;&#20197;&#19978;
                | E&#24037;&#20107;           -- ^ &#22303;&#26408;&#24037;&#20107;&#12392;&#24314;&#31689;&#24037;&#20107;&#12398;&#26045;&#24037;&#38989;&#12364;&#12356;&#12378;&#12428;&#12418;&#26045;&#24037;&#38989;&#20840;&#20307;&#12398;80&#65285;&#26410;
                deriving (Eq, Enum, Show, Read, Generic)
instance NFData E&#20107;&#26989;&#24418;&#24907;


parserE&#20107;&#26989;&#24418;&#24907; =    f E&#35069;&#36896;&#21368;&#22770;      
                &lt;|&gt;  f E&#35069;&#36896;&#36960;&#38548;&#23567;&#22770;        
                &lt;|&gt;  f E&#21152;&#24037;        
                &lt;|&gt;  f E&#20182;&#20225;&#26989;&#21368;&#22770;     
                &lt;|&gt;  f E&#35069;&#36896;&#23567;&#22770;      
                &lt;|&gt;  f E&#24215;&#38957;&#23567;&#22770;      
                &lt;|&gt;  f E&#36960;&#38548;&#23567;&#22770;      
                &lt;|&gt;  f E&#39135;&#21697;&#23567;&#22770;      
                &lt;|&gt;  f E&#22303;&#26408;        
                &lt;|&gt;  f E&#24314;&#31689;        
                &lt;|&gt;  f E&#24037;&#20107;        
                where f s = try( string (T.pack (show s))) &gt;&gt; return s


------------------------------------------------------------------
-- ** &#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;
------------------------------------------------------------------
{- |  &#20107;&#26989;&#25152;&#35519;&#26619;&#31080;&#12395;&#12362;&#12369;&#12427;&#35519;&#26619;&#38917;&#30446;&#12300;&#31649;&#29702;&#12539;&#35036;&#21161;&#30340;&#26989;&#21209;&#12301;&#12391;&#12399;&#65292;
&#20107;&#26989;&#25152;&#12364;&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;&#12434;&#34892;&#12387;&#12390;&#12356;&#12427;&#22580;&#21512;&#12395;&#12399;&#65292;&#12300;&#31649;&#29702;&#36939;&#21942;&#26989;&#21209;&#65292;&#35036;&#21161;&#30340;&#26989;&#21209;&#65292;&#33258;&#23478;&#29992;&#20489;&#24235;&#12301;&#12363;&#12425;&#36984;&#25246;&#12377;&#12427;&#24418;&#24335;&#12398;&#35519;&#26619;&#12434;&#34892;&#12387;&#12390;&#12356;&#12427;&#65294;
&#32076;&#28168;&#12475;&#12531;&#12469;&#12473;&#20998;&#39006;&#12395;&#12362;&#12356;&#12390;&#12399;&#65292;&#29305;&#27530;&#12394;&#38917;&#30446;&#12392;&#12375;&#12390;&#65292;
&#12300;&#20027;&#12392;&#12375;&#12390;&#31649;&#29702;&#20107;&#21209;&#12434;&#34892;&#12358;&#26412;&#31038;&#31561;&#12301;&#65292;&#12300;&#12381;&#12398;&#20182;&#12398;&#31649;&#29702;&#65292;&#35036;&#21161;&#30340;&#32076;&#28168;&#27963;&#21205;&#12434;&#34892;&#12358;&#20107;&#26989;&#25152;&#12301;&#65292;&#12300;&#33258;&#23478;&#29992;&#20489;&#24235;&#12301;&#12364;&#23384;&#22312;&#12375;&#65292;
&#12371;&#12428;&#12425;&#12398;&#38917;&#30446;&#12408;&#12398;&#29987;&#26989;&#26684;&#20184;&#12369;&#12395;&#12362;&#12356;&#12390;&#21033;&#29992;&#12373;&#12428;&#12427;&#65294;-}


data E&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;    = E&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209; 
                        | E&#35036;&#21161;&#30340;&#26989;&#21209;
                        | E&#33258;&#23478;&#29992;&#20489;&#24235;
                        deriving (Eq, Enum, Show, Read, Generic)
instance NFData E&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;

parserE&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209; =  try( string (T.pack &quot;E&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209;&quot;)  &gt;&gt; return E&#31649;&#29702;&#35036;&#21161;&#30340;&#26989;&#21209; )   
                    &lt;|&gt;  try( string (T.pack &quot;E&#35036;&#21161;&#30340;&#26989;&#21209;&quot;)      &gt;&gt; return E&#35036;&#21161;&#30340;&#26989;&#21209;     )         
                    &lt;|&gt;  try( string (T.pack &quot;E&#33258;&#23478;&#29992;&#20489;&#24235;&quot;)      &gt;&gt; return E&#33258;&#23478;&#29992;&#20489;&#24235;     ) 

------------------------------------------------------------------
-- ** &#32076;&#21942;&#32068;&#32340;
------------------------------------------------------------------

data E&#32076;&#21942;&#32068;&#32340;      = E&#20491;&#20154;&#32076;&#21942;
                    | E&#26666;&#24335;&#20250;&#31038;
                    | E&#21512;&#21517;&#20250;&#31038;
                    | E&#21512;&#21516;&#20250;&#31038;
                    | E&#20250;&#31038;&#20197;&#22806;&#12398;&#27861;&#20154;
                    | E&#22806;&#22269;&#12398;&#20250;&#31038;
                    | E&#27861;&#20154;&#12391;&#12394;&#12356;&#22243;&#20307;
                    deriving (Eq,Enum,Show, Read, Generic)
instance NFData E&#32076;&#21942;&#32068;&#32340;

parserE&#32076;&#21942;&#32068;&#32340; =    f E&#20491;&#20154;&#32076;&#21942;         
                &lt;|&gt;  f E&#26666;&#24335;&#20250;&#31038;               
                &lt;|&gt;  f E&#21512;&#21517;&#20250;&#31038;       
                &lt;|&gt;  f E&#21512;&#21516;&#20250;&#31038;          
                &lt;|&gt;  f E&#20250;&#31038;&#20197;&#22806;&#12398;&#27861;&#20154;   
                &lt;|&gt;  f E&#22806;&#22269;&#12398;&#20250;&#31038;       
                &lt;|&gt;  f E&#27861;&#20154;&#12391;&#12394;&#12356;&#22243;&#20307;   
                where f s = try( string (T.pack (show s))) &gt;&gt; return s

-- ----------------------------------------------------------------
-- ** &#21336;&#29420;&#20107;&#26989;&#25152;&#12539;&#26412;&#25152;&#12539;&#25903;&#25152;&#12398;&#21029;&#31561;
-- ----------------------------------------------------------------

data E&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;      = E&#21336;&#29420;&#20107;&#26989;&#25152;
                            | E&#26412;&#25152;
                            | E&#25903;&#25152;
                            deriving (Eq,Enum,Read,Show, Generic)
instance NFData E&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;

parserE&#21336;&#29420;&#26412;&#25152;&#25903;&#25152;&#21306;&#20998;  =   try( string (T.pack &quot;E&#21336;&#29420;&#20107;&#26989;&#25152;&quot;)     &gt;&gt; return E&#21336;&#29420;&#20107;&#26989;&#25152;         )   
                        &lt;|&gt;  try( string (T.pack &quot;E&#26412;&#25152;&quot;)           &gt;&gt; return E&#26412;&#25152;         )         
                        &lt;|&gt;  try( string (T.pack &quot;E&#25903;&#25152;&quot;)           &gt;&gt; return E&#25903;&#25152;         ) 

------------------------------------------------------
-- ** &#29987;&#26989;&#26684;&#20184;&#12369;
------------------------------------------------------
type Goods_name = TL.Text
type Goods_code = TL.Text

{- |  &#20107;&#26989;&#25152;/&#20225;&#26989;&#12395;&#26684;&#20184;&#12369;&#12425;&#12428;&#12383;&#29987;&#26989;&#12434;&#34920;&#12377;&#65294;&#35519;&#26619;&#31080;&#19978;&#12395;&#38917;&#30446;&#12399;&#12394;&#12367;&#65292;
&#20182;&#12398;&#24773;&#22577;&#12363;&#12425;&#12300;4.1.1.5&#31456; &#29987;&#26989;&#26684;&#20184;&#12369;&#12301;&#12395;&#12362;&#12356;&#12390;&#35500;&#26126;&#12373;&#12428;&#12427;&#29987;&#26989;&#26684;&#20184;&#12369;&#20966;&#29702;&#12434;&#32076;&#12390;&#27770;&#23450;&#12373;&#12428;&#12427;&#12497;&#12521;&#12513;&#12540;&#12479;&#12540;&#65294;-}


data E&#29987;&#26989;&#26684;&#20184; = E&#29987;&#26989;&#26684;&#20184;  { _&#22823;&#20998;&#39006;       :: Goods_code
                            , _15&#20998;&#39006;       :: Goods_code
                            , _&#20013;&#20998;&#39006;       :: Goods_code
                            , _&#23567;&#20998;&#39006;       :: Goods_code
                            , _35&#20998;&#39006;       :: Goods_code
                            , _&#32048;&#20998;&#39006;       :: Goods_code
                            } deriving (Eq,Read,Show, Generic)
instance NFData E&#29987;&#26989;&#26684;&#20184;


parserE&#29987;&#26989;&#26684;&#20184; =  do 
                string (T.pack &quot;E&#29987;&#26989;&#26684;&#20184; {&quot;)
                d1 &lt;- f &quot;_&#22823;&#20998;&#39006; = &quot;
                d2 &lt;- f &quot;_15&#20998;&#39006; = &quot;
                d3 &lt;- f &quot;_&#20013;&#20998;&#39006; = &quot;
                d4 &lt;- f &quot;_&#23567;&#20998;&#39006; = &quot;
                d5 &lt;- f &quot;_35&#20998;&#39006; = &quot;
                d6 &lt;- f &quot;_&#32048;&#20998;&#39006; = &quot;
                return (E&#29987;&#26989;&#26684;&#20184; d1 d2 d3 d4 d5 d6)

            where
            f :: String -&gt; Parser TL.Text
            f s =   do 
                    string (T.pack s)
                    di &lt;-  quotedCell
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return (TL.pack di) 

------------------------------------------------------------------
-- ** &#35519;&#26619;&#31080;&#12398;&#31278;&#21029;
------------------------------------------------------------------
data E&#35519;&#26619;&#31080;    = E&#21336;&#29420;&#20107;&#26989;&#25152;&#35519;&#26619;&#31080;
                | E&#29987;&#26989;&#20849;&#36890;&#35519;&#26619;&#31080;
                | E&#20225;&#26989;&#35519;&#26619;&#31080;
                | E&#20107;&#26989;&#25152;&#35519;&#26619;&#31080;
                | E&#22243;&#20307;&#35519;&#26619;&#31080;
                | E&#20491;&#20154;&#32076;&#21942;&#35519;&#26619;&#31080;
                deriving (Eq, Enum, Read, Show, Generic)
instance NFData E&#35519;&#26619;&#31080;


parserE&#35519;&#26619;&#31080;    =   f E&#21336;&#29420;&#20107;&#26989;&#25152;&#35519;&#26619;&#31080;   
                &lt;|&gt;  f E&#29987;&#26989;&#20849;&#36890;&#35519;&#26619;&#31080;           
                &lt;|&gt;  f E&#20225;&#26989;&#35519;&#26619;&#31080;       
                &lt;|&gt;  f E&#20107;&#26989;&#25152;&#35519;&#26619;&#31080;        
                &lt;|&gt;  f E&#22243;&#20307;&#35519;&#26619;&#31080;         
                &lt;|&gt;  f E&#20491;&#20154;&#32076;&#21942;&#35519;&#26619;&#31080;   
                where f s = try( string (T.pack (show s))) &gt;&gt; return s

data E&#23550;&#35937;&#29987;&#26989;   = E&#29987;&#26989;&#12394;&#12375;            | E&#36786;&#26519;&#28417;&#26989;         | E&#37489;&#26989;
                 | E&#35069;&#36896;&#26989;              | E&#21830;&#26989;             | E&#21307;&#30274;&#31119;&#31049;
                 | E&#23398;&#26657;&#25945;&#32946;            | E&#21332;&#21516;&#32068;&#21512;         | E&#12469;&#12540;&#12499;&#12473;B
                 | E&#20849;&#36890;                | E&#24314;&#35373;&#12469;&#12540;&#12499;&#12473;A    | E&#22243;&#20307;
                 | E&#24314;&#35373;&#12469;&#12540;&#12499;&#12473;A&#23398;&#26657;   | E&#20840;&#29987;&#26989;
                 deriving (Eq, Enum, Read,Show, Generic)
instance NFData E&#23550;&#35937;&#29987;&#26989;

parserE&#23550;&#35937;&#29987;&#26989;  =   f E&#29987;&#26989;&#12394;&#12375;           
                &lt;|&gt;  f E&#36786;&#26519;&#28417;&#26989;                 
                &lt;|&gt;  f E&#37489;&#26989;             
                &lt;|&gt;  f E&#35069;&#36896;&#26989;              
                &lt;|&gt;  f E&#21830;&#26989;               
                &lt;|&gt;  f E&#21307;&#30274;&#31119;&#31049;         
                &lt;|&gt;  f E&#23398;&#26657;&#25945;&#32946;         
                &lt;|&gt;  f E&#21332;&#21516;&#32068;&#21512;         
                &lt;|&gt;  f E&#12469;&#12540;&#12499;&#12473;B        
                &lt;|&gt;  f E&#20849;&#36890;             
                &lt;|&gt;  f E&#24314;&#35373;&#12469;&#12540;&#12499;&#12473;A    
                &lt;|&gt;  f E&#22243;&#20307;             
                &lt;|&gt;  f E&#24314;&#35373;&#12469;&#12540;&#12499;&#12473;A&#23398;&#26657;
                &lt;|&gt;  f E&#20840;&#29987;&#26989;           
                where f s = try( string (T.pack (show s))) &gt;&gt; return s

data E&#22238;&#31572;&#20027;&#20307;  = E&#20491;&#20154;&#32076;&#21942;&#32773;&#29992;
                | E&#22243;&#20307;&#27861;&#20154;&#29992;
                | E&#25351;&#23450;&#12394;&#12375;
                deriving (Eq, Enum, Read,Show, Generic)
instance NFData E&#22238;&#31572;&#20027;&#20307;

parserE&#22238;&#31572;&#20027;&#20307;  =   try( string (T.pack &quot;E&#20491;&#20154;&#32076;&#21942;&#32773;&#29992;&quot;)   &gt;&gt; return E&#20491;&#20154;&#32076;&#21942;&#32773;&#29992; )   
                &lt;|&gt;  try( string (T.pack &quot;E&#22243;&#20307;&#27861;&#20154;&#29992;&quot;)     &gt;&gt; return E&#22243;&#20307;&#27861;&#20154;&#29992;   )         
                &lt;|&gt;  try( string (T.pack &quot;E&#25351;&#23450;&#12394;&#12375;&quot;)       &gt;&gt; return E&#25351;&#23450;&#12394;&#12375;     ) 

data E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; = E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;  { _&#35519;&#26619;&#31080;   :: E&#35519;&#26619;&#31080;
                                    , _&#23550;&#35937;&#29987;&#26989; :: E&#23550;&#35937;&#29987;&#26989;
                                    , _&#22238;&#31572;&#20027;&#20307; :: E&#22238;&#31572;&#20027;&#20307;} 
                                    deriving (Eq,Read,Show, Generic)

instance NFData E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006;


-- | &gt;&gt;&gt; parseTest parserE&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; $ TL.pack $ show $ E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; E&#21336;&#29420;&#20107;&#26989;&#25152;&#35519;&#26619;&#31080; E&#22243;&#20307; E&#25351;&#23450;&#12394;&#12375;
--   &gt;&gt;&gt; Done &quot;&quot; (E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; {_&#35519;&#26619;&#31080; = E&#21336;&#29420;&#20107;&#26989;&#25152;&#35519;&#26619;&#31080;, _&#23550;&#35937;&#29987;&#26989; = E&#22243;&#20307;, _&#22238;&#31572;&#20027;&#20307; = E&#25351;&#23450;&#12394;&#12375;})

parserE&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; =  do 
                string (T.pack &quot;E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; {&quot;)
                
                string (T.pack &quot;_&#35519;&#26619;&#31080; = &quot;)
                d1 &lt;- parserE&#35519;&#26619;&#31080;   
                string (T.pack &quot;, &quot;)

                string (T.pack &quot;_&#23550;&#35937;&#29987;&#26989; = &quot;)                
                d2 &lt;- parserE&#23550;&#35937;&#29987;&#26989;
                string (T.pack &quot;, &quot;)

                string (T.pack &quot;_&#22238;&#31572;&#20027;&#20307; = &quot;)                
                d3 &lt;- parserE&#22238;&#31572;&#20027;&#20307; 
                string (T.pack &quot;}&quot;)
                return (E&#35519;&#26619;&#31080;&#12398;&#31278;&#39006; d1 d2 d3)

------------------------------------------------------------------
-- ** &#24180;&#38291;&#21830;&#21697;&#36009;&#22770;&#38989;&#31561;
------------------------------------------------------------------
-- | &#24180;&#38291;&#21830;&#21697;&#36009;&#22770;&#38989;&#12364;&#22810;&#12356;&#37096;&#38272;
data E&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272; = E&#23567;&#22770; | E&#21368;&#22770;  deriving (Eq,Show, Read, Generic)
instance NFData E&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;

parserE&#21830;&#21697;&#36009;&#22770;&#38989;&#26368;&#22810;&#37096;&#38272;    =  f E&#23567;&#22770;
                            &lt;|&gt; f E&#21368;&#22770;
                            where f s = try( string (T.pack (show s))) &gt;&gt; return s

------------------------------------------------------------------
-- ** &#21307;&#30274;&#65292;&#31119;&#31049;&#12398;&#20107;&#26989;&#21454;&#20837;&#20869;&#35379;
------------------------------------------------------------------
-- | &#21307;&#30274;&#20107;&#26989;&#24418;&#24907;&#12395;&#12362;&#12369;&#12427;7&#21306;&#20998;
data E&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;     = E&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;
                              { _&#20445;&#38522;&#35386;&#30274;&#21454;&#20837;         :: Double    
                              , _&#20445;&#38522;&#22806;&#35386;&#30274;&#21454;&#20837;       :: Double 
                              , _&#26045;&#35373;&#20171;&#35703;&#21454;&#20837;         :: Double    
                              , _&#36890;&#25152;&#20171;&#35703;&#35370;&#21839;&#20171;&#35703;&#21454;&#20837; :: Double 
                              , _&#31038;&#20250;&#20445;&#38522;&#20107;&#26989;&#21454;&#20837;     :: Double  
                              , _&#20445;&#20581;&#34907;&#29983;&#20107;&#26989;&#21454;&#20837;     :: Double  
                              , _&#31038;&#20250;&#31119;&#31049;&#20107;&#26989;&#21454;&#20837;     :: Double }
                              deriving (Show, Read, Eq, Generic)

instance NFData E&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049;

parserE&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049; =  do 
                string (T.pack &quot;E&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049; {&quot;)
                d1 &lt;- f &quot;_&#20445;&#38522;&#35386;&#30274;&#21454;&#20837; = &quot;
                d2 &lt;- f &quot;_&#20445;&#38522;&#22806;&#35386;&#30274;&#21454;&#20837; = &quot;
                d3 &lt;- f &quot;_&#26045;&#35373;&#20171;&#35703;&#21454;&#20837; = &quot;
                d4 &lt;- f &quot;_&#36890;&#25152;&#20171;&#35703;&#35370;&#21839;&#20171;&#35703;&#21454;&#20837; = &quot;
                d5 &lt;- f &quot;_&#31038;&#20250;&#20445;&#38522;&#20107;&#26989;&#21454;&#20837; = &quot;
                d6 &lt;- f &quot;_&#20445;&#20581;&#34907;&#29983;&#20107;&#26989;&#21454;&#20837; = &quot;
                d7 &lt;- f &quot;_&#31038;&#20250;&#31119;&#31049;&#20107;&#26989;&#21454;&#20837; = &quot;
                return (E&#20107;&#26989;&#21454;&#20837;_&#21307;&#30274;&#31119;&#31049; d1 d2 d3 d4 d5 d6 d7)
            where
            f :: String -&gt; Parser Double
            f s =   do 
                    string (T.pack s)
                    di &lt;-  DATL.double
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return di 


------------------------------------------------------------------
-- ** &#20107;&#26989;&#25152;&#12398;&#24418;&#24907;&#65292;&#20027;&#12394;&#20107;&#26989;&#12398;&#20869;&#23481;&#65288;&#21307;&#30274;&#65292;&#31119;&#31049;&#65289;
------------------------------------------------------------------

-- | &#21307;&#30274;&#20107;&#26989;&#24418;&#24907;&#12395;&#12362;&#12369;&#12427;32&#21306;&#20998;
data E&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;   
        = E&#19968;&#33324;&#30149;&#38498;                   | E&#31934;&#31070;&#31185;&#30149;&#38498;                        | E&#26377;&#24202;&#35386;&#30274;&#25152;
        | E&#28961;&#24202;&#35386;&#30274;&#25152;                 | E&#27503;&#31185;&#35386;&#30274;&#25152;                        | E&#21161;&#29987;&#25152;&#21161;&#29987;&#24107;&#26989;
        | E&#30475;&#35703;&#26989;                     | E&#26045;&#34899;&#26989;                            | E&#12381;&#12398;&#20182;&#12398;&#30274;&#39178;&#25152;
        | E&#27503;&#31185;&#25216;&#24037;&#25152;                 | E&#12381;&#12398;&#20182;&#12398;&#21307;&#30274;&#12395;&#38468;&#24111;&#12377;&#12427;&#12469;&#12540;&#12499;&#12473;&#26989;  | E&#32080;&#26680;&#20581;&#24247;&#30456;&#35527;&#26045;&#35373;      
        | E&#31934;&#31070;&#20445;&#20581;&#30456;&#35527;&#26045;&#35373;           | E&#27597;&#23376;&#20581;&#24247;&#30456;&#35527;&#26045;&#35373;                  | E&#12381;&#12398;&#20182;&#12398;&#20581;&#24247;&#30456;&#35527;&#26045;&#35373;
        | E&#26908;&#26619;&#26989;                     | E&#28040;&#27602;&#26989;                            | E&#12381;&#12398;&#20182;&#12398;&#20445;&#20581;&#34907;&#29983;
        | E&#31038;&#20250;&#20445;&#38522;&#20107;&#26989;&#22243;&#20307;           | E&#20445;&#32946;&#25152;                            | E&#12381;&#12398;&#20182;&#12398;&#20816;&#31461;&#31119;&#31049;&#20107;&#26989;
        | E&#29305;&#21029;&#39178;&#35703;&#32769;&#20154;&#12507;&#12540;&#12512;         | E&#20171;&#35703;&#32769;&#20154;&#20445;&#20581;&#26045;&#35373;                  | E&#36890;&#25152;&#30701;&#26399;&#20837;&#25152;&#20171;&#35703;&#20107;&#26989;
        | E&#35370;&#21839;&#20171;&#35703;&#20107;&#26989;               | E&#35469;&#30693;&#30151;&#32769;&#20154;&#12464;&#12523;&#12540;&#12503;&#12507;&#12540;&#12512;          | E&#26377;&#26009;&#32769;&#20154;&#12507;&#12540;&#12512;
        | E&#12381;&#12398;&#20182;&#12398;&#32769;&#20154;&#31119;&#31049;&#20171;&#35703;&#20107;&#26989;   | E&#23621;&#20303;&#25903;&#25588;&#20107;&#26989;                      | E&#12381;&#12398;&#20182;&#12398;&#38556;&#30861;&#32773;&#31119;&#31049;&#20107;&#26989;
        | E&#26356;&#29983;&#20445;&#35703;&#20107;&#26989;               | E&#12381;&#12398;&#20182;&#12398;&#31038;&#20250;&#20445;&#38522;&#31038;&#20250;&#31119;&#31049;&#20171;&#35703;&#20107;&#26989; 
        deriving (Show,Enum, Eq, Read, Ord, Generic)

instance NFData E&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;

parserE&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;   =  f E&#19968;&#33324;&#30149;&#38498;                
                            &lt;|&gt; f E&#28961;&#24202;&#35386;&#30274;&#25152;              
                            &lt;|&gt; f E&#30475;&#35703;&#26989;                  
                            &lt;|&gt; f E&#27503;&#31185;&#25216;&#24037;&#25152;              
                            &lt;|&gt; f E&#31934;&#31070;&#20445;&#20581;&#30456;&#35527;&#26045;&#35373;        
                            &lt;|&gt; f E&#26908;&#26619;&#26989;                  
                            &lt;|&gt; f E&#31038;&#20250;&#20445;&#38522;&#20107;&#26989;&#22243;&#20307;        
                            &lt;|&gt; f E&#29305;&#21029;&#39178;&#35703;&#32769;&#20154;&#12507;&#12540;&#12512;      
                            &lt;|&gt; f E&#35370;&#21839;&#20171;&#35703;&#20107;&#26989;            
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#32769;&#20154;&#31119;&#31049;&#20171;&#35703;&#20107;&#26989;
                            &lt;|&gt; f E&#26356;&#29983;&#20445;&#35703;&#20107;&#26989;            
                            &lt;|&gt; f E&#31934;&#31070;&#31185;&#30149;&#38498;                       
                            &lt;|&gt; f E&#27503;&#31185;&#35386;&#30274;&#25152;                       
                            &lt;|&gt; f E&#26045;&#34899;&#26989;                           
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#21307;&#30274;&#12395;&#38468;&#24111;&#12377;&#12427;&#12469;&#12540;&#12499;&#12473;&#26989; 
                            &lt;|&gt; f E&#27597;&#23376;&#20581;&#24247;&#30456;&#35527;&#26045;&#35373;                 
                            &lt;|&gt; f E&#28040;&#27602;&#26989;                           
                            &lt;|&gt; f E&#20445;&#32946;&#25152;                           
                            &lt;|&gt; f E&#20171;&#35703;&#32769;&#20154;&#20445;&#20581;&#26045;&#35373;                 
                            &lt;|&gt; f E&#35469;&#30693;&#30151;&#32769;&#20154;&#12464;&#12523;&#12540;&#12503;&#12507;&#12540;&#12512;         
                            &lt;|&gt; f E&#23621;&#20303;&#25903;&#25588;&#20107;&#26989;                     
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#31038;&#20250;&#20445;&#38522;&#31038;&#20250;&#31119;&#31049;&#20171;&#35703;&#20107;&#26989; 
                            &lt;|&gt; f E&#26377;&#24202;&#35386;&#30274;&#25152;
                            &lt;|&gt; f E&#21161;&#29987;&#25152;&#21161;&#29987;&#24107;&#26989;
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#30274;&#39178;&#25152;
                            &lt;|&gt; f E&#32080;&#26680;&#20581;&#24247;&#30456;&#35527;&#26045;&#35373;      
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#20581;&#24247;&#30456;&#35527;&#26045;&#35373;
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#20445;&#20581;&#34907;&#29983;
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#20816;&#31461;&#31119;&#31049;&#20107;&#26989;
                            &lt;|&gt; f E&#36890;&#25152;&#30701;&#26399;&#20837;&#25152;&#20171;&#35703;&#20107;&#26989;
                            &lt;|&gt; f E&#26377;&#26009;&#32769;&#20154;&#12507;&#12540;&#12512;
                            &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#38556;&#30861;&#32773;&#31119;&#31049;&#20107;&#26989;
                            where f s = try( string (T.pack (show s))) &gt;&gt; return s

parseE&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049; :: TL.Text -&gt;  E&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049;
parseE&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049; tx = case parse parserE&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049; tx of 
        Done a r        -&gt; r
        Fail a xs err   -&gt; error $ &quot;Can not parse E&#20107;&#26989;&#25152;&#24418;&#24907;_&#21307;&#30274;&#31119;&#31049; :&quot;   ++ show a
                                                                            ++ show xs 
                                                                            ++ show err 


------------------------------------------------------------------
-- ** &#22243;&#20307;&#12398;&#31278;&#39006;
------------------------------------------------------------------

data E&#22243;&#20307;&#12398;&#31278;&#39006;     =  E&#25919;&#27835;&#22243;&#20307;
                      | E&#32076;&#28168;&#22243;&#20307;
                      | E&#21172;&#20685;&#22243;&#20307;
                      | E&#23398;&#34899;&#22243;&#20307;&#25991;&#21270;&#22243;&#20307;
                      | E&#12381;&#12398;&#20182;&#12398;&#22243;&#20307;
                      | E&#31070;&#36947;&#31995;&#23447;&#25945;
                      | E&#20175;&#25945;&#31995;&#23447;&#25945;
                      | E&#12461;&#12522;&#12473;&#12488;&#25945;&#31995;&#23447;&#25945;
                      | E&#12381;&#12398;&#20182;&#12398;&#23447;&#25945;
                    deriving (Show, Read, Eq, Ord, Generic)
instance NFData E&#22243;&#20307;&#12398;&#31278;&#39006;
                

parserE&#22243;&#20307;&#12398;&#31278;&#39006;    =  f E&#25919;&#27835;&#22243;&#20307;
                    &lt;|&gt; f E&#32076;&#28168;&#22243;&#20307;
                    &lt;|&gt; f E&#21172;&#20685;&#22243;&#20307;
                    &lt;|&gt; f E&#23398;&#34899;&#22243;&#20307;&#25991;&#21270;&#22243;&#20307;
                    &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#22243;&#20307;
                    &lt;|&gt; f E&#31070;&#36947;&#31995;&#23447;&#25945;
                    &lt;|&gt; f E&#20175;&#25945;&#31995;&#23447;&#25945;
                    &lt;|&gt; f E&#12461;&#12522;&#12473;&#12488;&#25945;&#31995;&#23447;&#25945;
                    &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#23447;&#25945;                            
                    where f s = try( string (T.pack (show s))) &gt;&gt; return s


parseE&#22243;&#20307;&#12398;&#31278;&#39006; :: TL.Text -&gt;  E&#22243;&#20307;&#12398;&#31278;&#39006;
parseE&#22243;&#20307;&#12398;&#31278;&#39006; tx = case parse parserE&#22243;&#20307;&#12398;&#31278;&#39006; tx of 
        Done a r        -&gt; r
        Fail a xs err   -&gt; error $ &quot;Can not parse E&#22243;&#20307;&#12398;&#31278;&#39006; :&quot;    ++ show a   ++ &quot; , &quot;
                                                                    ++ show xs 
                                                                    ++ show err
------------------------------------------------------------------
-- ** &#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;
------------------------------------------------------------------
data E&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;   = E&#36786;&#26989;&#21332;&#21516;&#32068;&#21512;
                       | E&#28417;&#26989;&#21332;&#21516;&#32068;&#21512;
                       | E&#27700;&#29987;&#21152;&#24037;&#21332;&#21516;&#32068;&#21512;
                       | E&#26862;&#26519;&#32068;&#21512;
                       | E&#20107;&#26989;&#21332;&#21516;&#32068;&#21512;            -- ^ &#24179;&#25104;28&#24180;&#12399;,&#12381;&#12398;&#20182;&#12398;&#20107;&#26989;&#21332;&#21516;&#32068;&#21512;&#12392;&#20107;&#26989;&#21332;&#21516;&#32068;&#21512;&#12364;&#32113;&#21512;
                       | E&#21332;&#21516;&#32068;&#21512;&#20197;&#22806;
                       | E&#12381;&#12398;&#20182;&#12398;&#20107;&#26989;&#21332;&#21516;&#32068;&#21512;
                       deriving (Show,Read,Eq,Ord,Generic)
instance NFData E&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;

parserE&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;     = f E&#36786;&#26989;&#21332;&#21516;&#32068;&#21512;
                        &lt;|&gt; f E&#28417;&#26989;&#21332;&#21516;&#32068;&#21512;
                        &lt;|&gt; f E&#27700;&#29987;&#21152;&#24037;&#21332;&#21516;&#32068;&#21512;
                        &lt;|&gt; f E&#26862;&#26519;&#32068;&#21512;
                        &lt;|&gt; f E&#20107;&#26989;&#21332;&#21516;&#32068;&#21512;        
                        &lt;|&gt; f E&#21332;&#21516;&#32068;&#21512;&#20197;&#22806;
                        &lt;|&gt; f E&#12381;&#12398;&#20182;&#12398;&#20107;&#26989;&#21332;&#21516;&#32068;&#21512;                        
                        where f s = try( string (T.pack (show s))) &gt;&gt; return s


parseE&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006; :: TL.Text -&gt;  E&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006;
parseE&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006; tx = case parse parserE&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006; tx of 
        Done a r        -&gt; r
        Fail a xs err   -&gt; error $ &quot;Can not parse E&#21332;&#21516;&#32068;&#21512;&#12398;&#31278;&#39006; :&quot;    ++ show a
                                                                        ++ show xs 
                                                                        ++ show err 

------------------------------------------------------------------
-- ** &#21307;&#30274;&#31119;&#31049;&#12398;&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;, &#12469;&#12540;&#12499;&#12473;&#38306;&#36899;&#29987;&#26989;B&#12398;&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;
------------------------------------------------------------------

data E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;  = E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512; 
                        { _&#19968;&#33324;&#28040;&#36027;&#32773;        :: Double
                        , _&#27665;&#38291;&#20225;&#26989;          :: Double
                        , _&#23448;&#20844;&#24193;            :: Double
                        , _&#28023;&#22806;&#21462;&#24341;          :: Double
                        , _&#21516;&#19968;&#20225;&#26989;          :: Double }
                        deriving (Show, Read, Eq, Generic)

instance NFData E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512;

parserE&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512; =  do 
                string (T.pack &quot;E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512; {&quot;)
                d1 &lt;- f &quot;_&#19968;&#33324;&#28040;&#36027;&#32773; = &quot;
                d2 &lt;- f &quot;_&#27665;&#38291;&#20225;&#26989; = &quot;
                d3 &lt;- f &quot;_&#23448;&#20844;&#24193; = &quot;
                d4 &lt;- f &quot;_&#28023;&#22806;&#21462;&#24341; = &quot;
                d5 &lt;- f &quot;_&#21516;&#19968;&#20225;&#26989; = &quot;
                return (E&#30456;&#25163;&#20808;&#21029;&#21454;&#20837;&#21106;&#21512; d1 d2 d3 d4 d5)

            where
            f :: String -&gt; Parser Double
            f s =   do 
                    string (T.pack s)
                    di &lt;-  DATL.double
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return di 

-----------------------------------------------------------
-- ** &#24215;&#33303;&#24418;&#24907;
-----------------------------------------------------------
data E&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;  = E&#21508;&#31278;&#21830;&#21697;&#23567;&#22770;&#24215; | E&#12467;&#12531;&#12499;&#12491;&#12456;&#12531;&#12473;&#12473;&#12488;&#12450; |  E&#12489;&#12521;&#12483;&#12464;&#12473;&#12488;&#12450; | E&#12507;&#12540;&#12512;&#12475;&#12531;&#12479;&#12540;
                deriving (Show, Read, Eq, Generic)

instance NFData E&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;

parserE&#24215;&#33303;&#24418;&#24907;_&#21830;&#26989;  =   f E&#21508;&#31278;&#21830;&#21697;&#23567;&#22770;&#24215;
                     &lt;|&gt;  f E&#12467;&#12531;&#12499;&#12491;&#12456;&#12531;&#12473;&#12473;&#12488;&#12450;
                     &lt;|&gt;  f E&#12489;&#12521;&#12483;&#12464;&#12473;&#12488;&#12450;
                     &lt;|&gt;  f E&#12507;&#12540;&#12512;&#12475;&#12531;&#12479;&#12540;
                     where f s = try( string (T.pack (show s))) &gt;&gt; return s



-----------------------------------------------------------
-- ** &#21830;&#21697;&#24418;&#24907;
-----------------------------------------------------------
data E&#21830;&#21697;&#24418;&#24907; = E&#21830;&#21697;&#24418;&#24907; 
               { _&#34915;&#26009;&#21697;        :: Double
               , _&#39154;&#39135;&#26009;&#21697;      :: Double
               , _&#12381;&#12398;&#20182;&#21830;&#21697;    :: Double}
               deriving (Show, Read, Eq, Generic)

instance NFData E&#21830;&#21697;&#24418;&#24907;

parserE&#21830;&#21697;&#24418;&#24907; =  do 
                string (T.pack &quot;E&#21830;&#21697;&#24418;&#24907; {&quot;)
                d1 &lt;- f &quot;_&#34915;&#26009;&#21697; = &quot;
                d2 &lt;- f &quot;_&#39154;&#39135;&#26009;&#21697; = &quot;
                d3 &lt;- f &quot;_&#12381;&#12398;&#20182;&#21830;&#21697; = &quot;
                return (E&#21830;&#21697;&#24418;&#24907; d1 d2 d3)

            where
            f :: String -&gt; Parser Double
            f s =   do 
                    string (T.pack s)
                    di &lt;-  DATL.double
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return di 

-----------------------------------------------------------
-- ** &#36009;&#22770;&#24418;&#24907;
-----------------------------------------------------------
data E&#36009;&#22770;&#24418;&#24907; = E&#36009;&#22770;&#24418;&#24907;
               { _&#24215;&#38957;&#36009;&#22770;           :: Double
               , _&#35370;&#21839;&#36009;&#22770;           :: Double
               , _&#36890;&#20449;&#36009;&#22770;           :: Double
               , _&#12452;&#12531;&#12479;&#12540;&#12493;&#12483;&#12488;&#36009;&#22770; :: Double
               , _&#33258;&#21205;&#36009;&#22770;&#27231;         :: Double
               , _&#12381;&#12398;&#20182;&#36009;&#22770;         :: Double }
               deriving (Show, Read, Eq, Generic)

instance NFData E&#36009;&#22770;&#24418;&#24907;

parserE&#36009;&#22770;&#24418;&#24907; =  do 
                string (T.pack &quot;E&#21830;&#21697;&#24418;&#24907; {&quot;)
                d1 &lt;- f &quot;_&#24215;&#38957;&#36009;&#22770; = &quot;
                d2 &lt;- f &quot;_&#35370;&#21839;&#36009;&#22770; = &quot;
                d3 &lt;- f &quot;_&#36890;&#20449;&#36009;&#22770; = &quot;
                d4 &lt;- f &quot;_&#12452;&#12531;&#12479;&#12540;&#12493;&#12483;&#12488;&#36009;&#22770; = &quot;
                d5 &lt;- f &quot;_&#33258;&#21205;&#36009;&#22770;&#27231; = &quot;
                d6 &lt;- f &quot;_&#12381;&#12398;&#20182;&#36009;&#22770; = &quot;
                return (E&#36009;&#22770;&#24418;&#24907; d1 d2 d3 d4 d5 d6)

            where
            f :: String -&gt; Parser Double
            f s =   do 
                    string (T.pack s)
                    di &lt;-  DATL.double
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return di 

------------------------------------------------------------------
-- ** &#24037;&#20107;&#31278;&#39006;
------------------------------------------------------------------
data E&#24037;&#20107;&#31278;&#39006; = E&#24037;&#20107;&#31278;&#39006; {_&#31278;&#39006;1 :: TL.Text, _&#31278;&#39006;2 :: TL.Text }
                deriving (Show, Read, Eq, Generic)
instance NFData E&#24037;&#20107;&#31278;&#39006;

parserE&#24037;&#20107;&#31278;&#39006; =  do 
                string (T.pack &quot;E&#24037;&#20107;&#31278;&#39006; {&quot;)
                d1 &lt;- f &quot;_&#31278;&#39006;1 = &quot;
                d2 &lt;- f &quot;_&#31278;&#39006;2 = &quot;
                return (E&#24037;&#20107;&#31278;&#39006; d1 d2)
            where
            f :: String -&gt; Parser TL.Text
            f s =   do 
                    string (T.pack s)
                    di &lt;-  quotedCell
                    try (string (T.pack &quot;, &quot;)) &lt;|&gt; (string (T.pack &quot;}&quot;))
                    return $! TL.pack di 



------------------------------------------------------
-- ** Cars
------------------------------------------------------
-- | &#12479;&#12503;&#12523;&#12398;&#12522;&#12473;&#12488;&#12398;&#12424;&#12358;&#12394;&#12487;&#12540;&#12479;&#12434;&#12371;&#12428;&#12391;&#20195;&#26367;&#12377;&#12427;

data Car  = Car {value :: Double
                , name :: TL.Text} 
                deriving (Eq, Show, Read, Generic)

instance Ord Car where
    compare   x y     = compare   (value x) (value y)
    (&lt;)       x y     = (&lt;)       (value x) (value y)
    (&lt;=)      x y     = (&lt;=)      (value x) (value y)
    (&gt;)       x y     = (&gt;)       (value x) (value y)
    (&gt;=)      x y     = (&gt;=)      (value x) (value y)
    max x y | x &gt;= y    = x
            | otherwise = y 

    min x y | x &lt;= y    = x
            | otherwise = y


instance NFData Car

parseCar :: Parser Car
parseCar     =  string (T.pack &quot;Car {value = &quot;)
             &gt;&gt; DATL.double &gt;&gt;= \dl
             -&gt; string (T.pack &quot;, name = &quot;)
             &gt;&gt; quotedCell &gt;&gt;= \tx 
             -&gt; char '}'
             &gt;&gt; return (Car dl (TL.pack tx))


type Cars = V.Vector Car


-- | Car &#12395;&#23550;&#12377;&#12427;Value&#12398;&#36275;&#12375;&#31639;
addValueCar :: Double -&gt; Car -&gt; Car
addValueCar dbl (Car v n) = Car (v + dbl) n

-- | Car&#12398;value&#12395;&#25968;&#20516;&#12434;&#20055;&#12378;&#12427;
multipleValueCar :: Double -&gt; Car -&gt; Car
multipleValueCar dl (Car v n) = Car (v * dl) n


-- | &#21517;&#21069;&#28961;&#38306;&#20418;&#12395;&#21512;&#35336;&#20516;&#12434;&#20986;&#12377;
sumCars :: Cars -&gt; Double 
sumCars cs = V.sum $! V.map value cs

-- | Null = 0 &#12392;&#12375;&#12390;&#12377;&#12409;&#12390;&#12398;&#20516;&#12434;&#36275;&#12377;
sumValCars :: ValCars -&gt; Double 
sumValCars Null        = 0
sumValCars (VCars cs ) = sumCars cs 

-- | ValCars&#12398;&#29305;&#23450;&#12398;name&#12391;&#12354;&#12427;Car&#12398;&#20516;&#12434;&#25277;&#20986;&#12377;&#12427;
getValofCars :: TL.Text -&gt; ValCars -&gt; Double
getValofCars tx Null        = 0  
getValofCars tx (VCars cs)  = V.sum $! V.map value $! V.filter (\x -&gt; name x == tx) cs
getValofCars tx _           = 0 


-- | Car &#12398; Map&#12395;&#12424;&#12427;&#22793;&#25563;
lookupCarNameErr :: Car -&gt; Map TL.Text TL.Text -&gt; Car
lookupCarNameErr ca mp = case Map.lookup (name ca) mp of
                         Just newName -&gt; Car (value ca) newName
                         Nothing      -&gt; error $ &quot;error : lookupCarNameErr ; can not find &quot; ++ TL.unpack (name ca)

-- | Cars &#12398;Map&#12395;&#12424;&#12427;&#22793;&#25563;
lookupCarsNameErr :: Cars -&gt; Map TL.Text TL.Text -&gt; Cars
lookupCarsNameErr cs mp = V.map (\x -&gt; lookupCarNameErr x mp ) cs

-- | Tuple &#12363;&#12425; Car&#12434;&#20316;&#12427;
tupleToCar :: (Double, TL.Text) -&gt; Car
tupleToCar (d,t) = Car d t 


carFromList :: [(Double, TL.Text)] -&gt; Cars
carFromList xs = V.map tupleToCar $! V.fromList xs


-- | &#21516;&#12376;Name &#12434;&#25345;&#12388;Car&#12434;&#32113;&#21512;&#12377;&#12427;
mergeSameNameCars :: Cars -&gt; Cars 
mergeSameNameCars cs | V.null cs            = cs
                     | V.length cs &lt;= 1     = cs
                     | otherwise            = runST $ do
                                            culcMap  &lt;- newSTRef Map.empty
                                            V.forM_ cs $ \c -&gt; do
                                                tmpMap &lt;-  readSTRef culcMap 
                                                let n = name c
                                                case Map.lookup n tmpMap of 
                                                    Just a   -&gt;  modifySTRef culcMap (Map.insert n (a + (value c)))
                                                    Nothing  -&gt;  modifySTRef culcMap (Map.insert n      (value c))
                                            
                                            resultMap &lt;- readSTRef culcMap
                                            return $! carFromList $! L.map (\(x,y) -&gt; (y,x)) $! Map.toList resultMap


-- | ValCars &#12395; Cars&#12434;&#32080;&#21512;&#12377;&#12427;
appendVCars :: Cars -&gt; ValCars -&gt; ValCars
appendVCars cs   Null         = VCars cs
appendVCars cs1  (VCars cs2)  = VCars $! cs1 V.++ cs2





-- | &#26368;&#22823;&#12398;Car&#12398; name&#12434;&#21462;&#24471;&#12377;&#12427;
--
--   Cars &#12364; null &#12398;&#12392;&#12365;&#12399;TL.empty&#12434;&#36820;&#12377;
vmaximumNameWithoutErr :: Cars -&gt; TL.Text
vmaximumNameWithoutErr cs   | V.null cs = TL.empty
                            | otherwise = name $! V.maximum cs




-- | &#26368;&#22823;&#12398;&#38917;&#30446;&#12398;Car&#12434;&#21462;&#24471;
-- 
-- &#26368;&#22823;&#20516;&#12364;&#37325;&#35079;&#12375;&#12390;&#12356;&#12383;&#22580;&#21512;&#12399;&#20840;&#12390;&#36820;&#12377;
vmaximumsWithoutErr :: Cars -&gt; [Car]
vmaximumsWithoutErr cs  | V.null cs = []
                        | otherwise = runST $ do
                                !maxCars     &lt;- newSTRef [V.head cs]
                                !tmpMaxValue &lt;- newSTRef ((value . V.head) cs :: Double)
                                
                                V.forM_ (V.tail cs) $ \c -&gt; do
                                    curValue &lt;- readSTRef tmpMaxValue
                                    when ( (value c) &gt; curValue) 
                                         (  writeSTRef tmpMaxValue (value c)
                                         &gt;&gt; writeSTRef maxCars     [c] ) 

                                    when ( (value c) == curValue)
                                         ( modifySTRef maxCars (c:)) 

                                resultList &lt;- readSTRef maxCars
                                return $ resultList


-- | value &#12364;&#26368;&#22823;&#12398;Car&#12398;name&#12434;&#21462;&#24471; 
--
-- &#26368;&#22823;&#20516;&#12364;&#37325;&#35079;&#12375;&#12390;&#12356;&#12383;&#22580;&#21512;&#12399;&#20840;&#12390;&#36820;&#12377;
vmaximumsNameWithoutErr :: Cars -&gt; [TL.Text]
vmaximumsNameWithoutErr cs = L.map name $! vmaximumsWithoutErr cs



















</span></pre></body></html>